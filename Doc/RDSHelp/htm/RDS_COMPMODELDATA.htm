<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru" xml:lang="ru">
<head>
  <link rel="stylesheet" type="text/css" href="../css/main.css" />
  <link rel="stylesheet" type="text/css" href="../css/cpp.css" />
  <meta http-equiv="Content-Type" content="text/html;charset=windows-1251" />
  <script type="text/javascript" src="script.js"></script>
  <title>А.3.3. RDS_COMPMODELDATA &ndash; структура данных модели</title>
</head><body onload="DocLoad()">
<div class="pageheader"><span class="off"><b>Текущий раздел:</b></span>
<div class="int"><p id="top"><a href="../index.htm">Описания RDS</a></p>
<div class="level"><p><a href="app_index.htm">Приложения</a></p>
<div class="level"><p><a href="app_index.htm#light_htm:app_a">Приложение А. Функции, константы и структуры RDS</a></p>
<div class="level"><p><a href="app_index.htm#light_htm:app_a_3">А.3. События модуля автокомпиляции и связанные с ними структуры</a></p>
<div class="level"><p>А.3.3. <span class="cpp">RDS_COMPMODELDATA</span> &ndash; структура данных модели</p>
</div>
</div>
</div>
</div>
</div></div>
<div class="topnav"><span class="off"><b>Навигация:</b></span>
<div class="left">
<span class="button"><a href="RDS_COMPMODULEDATA.htm" title="Предыдущий параграф" id="pgup">&lt;&lt;</a></span>
<span class="button"><a href="RDS_COMPM_ATTACHBLOCK.htm" title="Следующий параграф" id="pgdn">&gt;&gt;</a></span>
<span class="divider"></span>
<span class="button"><a href="app_index.htm#light_htm:RDS_COMPMODELDATA">Оглавление</a></span>
<span class="button"><a href="alpha.htm">Указатель</a></span>
</div>
</div>

<div class="text">
<h1 class="off">Приложения</h1>
<h2 class="off">Приложение А. Функции, константы и структуры RDS</h2>
<h3 class="off">А.3. События модуля автокомпиляции и связанные с ними структуры</h3>
<h4>А.3.3. <span class="cpp">RDS_COMPMODELDATA</span> &ndash; структура данных модели</h4>


<p><span id="ref1">Структура</span>
<span id="ref2">данных</span>
<span id="ref3">автокомпилируемой</span>
модели
<span class="cpp">RDS_COMPMODELDATA</span> содержит
основные параметры этой модели, которые нужны
<a href="app_a_3_1.htm" title="А.3.1. Функция модуля автокомпиляции">функции обслуживающего ее модуля</a> для реакции на
различные события. Эта структура создается перед первым подключением данной модели к какому-либо
блоку схемы и хранится в памяти до тех пор, пока эта модель не будет отключена от последнего
связанного с ней блока. Общая структура данных, используемых для автоматической компиляции моделей,
подробно рассмотрена в <a href="pm_index.htm#light_htm:pm_4" title="Глава 4. Создание модулей автоматической компиляции">главе 4 руководства программиста</a>.</p>

<pre class="cpp">  <span class="kw">typedef</span> <span class="kw">struct</span> {
    <span id="light_ref1"><a class="hidden" href="app_ids.htm#light_ref10" title="Идентификатор автокомпилируемой модели">RDS_MODELHANDLE</a></span> Model;  <span class="rem">// Идентификатор модели</span>
    <a class="hidden" href="app_ids.htm#light_ref20" title="Указатель на строку (char*)">LPSTR</a> ModelName;        <span class="rem">// Имя модели</span>
    <a class="hidden" href="app_ids.htm#light_ref20" title="Указатель на строку (char*)">LPSTR</a> ModelNameUC;      <span class="rem">// Имя модели в верхнем регистре</span>
    <a class="hidden" href="app_ids.htm#light_ref21" title="Указатель на любые данные (void*)">LPVOID</a> ModelData;       <span class="rem">// Адрес области данных модели</span>
    <span class="kw">int</span> NBlocks;            <span class="rem">// Число блоков, связанных</span>
                            <span class="rem">// с данной моделью</span>
    <span id="light_ref3"><a class="hidden" href="app_ids.htm#light_ref9" title="Идентификатор модуля автокомпиляции">RDS_COMPHANDLE</a></span> Module;  <span class="rem">// Идентификатор обслуживающего</span>
                            <span class="rem">// модуля автокомпиляции</span>

    <a class="hidden" href="app_ids.htm#light_ref20" title="Указатель на строку (char*)">LPSTR</a> CompDllName;      <span class="rem">// DLL скомпилированной модели</span>
    <a class="hidden" href="app_ids.htm#light_ref20" title="Указатель на строку (char*)">LPSTR</a> CompDllFunc;      <span class="rem">// Имя функции скомпилированной модели</span>
    <a class="hidden" href="app_ids.htm#light_ref11" title="Логический тип Windows API">BOOL</a> Valid;             <span class="rem">// Признак необходимости перекомпиляции</span>

    <a class="hidden" href="app_ids.htm#light_ref20" title="Указатель на строку (char*)">LPSTR</a> AltModelName;     <span class="rem">// Альтернативное имя модели</span>
    <span class="kw">int</span> Tag;                <span class="rem">// Пользовательское поле</span>
  } <span id="light_ref3">RDS_COMPMODELDATA</span>;
  <span class="kw">typedef</span> RDS_COMPMODELDATA *<span id="light_ref2">RDS_PCOMPMODELDATA</span>;</pre>

<p class="apphdr">Поля структуры</p>

<dl>
  <dt><span class="cpp">Model</span>&emsp;(<span class="cpp"><i>RDS_MODELHANDLE</i></span>)</dt>
  <dd>Уникальный идентификатор данной модели. Тип <span class="cpp"><a href="app_ids.htm#light_ref10" title="Идентификатор автокомпилируемой модели">RDS_MODELHANDLE</a></span>
  используется в RDS для указания конкретной автоматически компилируемой модели, с которой
  производится то или иное действие.</dd>

  <dt><span class="cpp">ModelName</span>&emsp;(<span class="cpp"><i>LPSTR</i></span>)</dt>
  <dd>Указатель на строку с именем данной модели во внутренней памяти RDS. Имя модели должно
  однозначно идентифицировать эту модель с точки зрения пользователя &ndash; именно это имя он
  указывает в
  <a href="um_2_9_1.htm#pic12" title="Вкладка компиляция окна параметров блока (модель не подключена)">окне параметров блока</a>, когда подключает к
  нему автоматически компилируемую модель. Имена моделей, отличающиеся только регистром символов,
  считаются в RDS одинаковыми. Если модуль автокомпиляции хранит тексты своих моделей в
  отдельных файлах, в качестве имени модели может использоваться имя файла с ее текстом. Функция
  модуля не должна изменять эту строку, для переименования модели следует использовать сервисную
  функцию <span class="cpp"><a href="rdscompRenameModel.htm" title="А.5.34.8. rdscompRenameModel &ndash; переименовать модель">rdscompRenameModel</a></span>.</dd>

  <dt><span class="cpp">ModelNameUC</span>&emsp;(<span class="cpp"><i>LPSTR</i></span>)</dt>
  <dd>Указатель на строку с именем данной модели, приведенным к верхнему регистру, во внутренней памяти
  RDS. Поскольку в RDS имена моделей, отличающиеся только регистром, считаются одинаковыми,
  эту строку можно использовать для поиска модели по имени. Функция модуля не должна изменять эту строку,
  для переименования модели следует использовать сервисную функцию
  <span class="cpp">rdscompRenameModel</span>.</dd>

  <dt><span class="cpp">ModelData</span>&emsp;(<span class="cpp"><i>LPVOID</i></span>)</dt>
  <dd>Указатель на личную область данных этой модели. Перед подключением данной модели к самому первому
  блоку схемы RDS записывает в это поле значение <span class="cpp">NULL</span> и больше к нему
  не обращается. Если модулю требуется отводить память для хранения параметров каждой из своих моделей,
  он может записать указатель на отведенную область памяти в это поле при инициализации модели, то есть в
  момент реакции на событие <span class="cpp"><a href="RDS_COMPM_MODELINIT.htm" title="А.3.4.13. RDS_COMPM_MODELINIT &ndash; инициализация модели">RDS_COMPM_MODELINIT</a></span>. В этом случае освободить отведенную
  область тоже должна будет функция модуля &ndash; обычно это делается перед отключением модели от
  последнего связанного с ней блока в реакции на событие <span class="cpp"><a href="RDS_COMPM_MODELCLEANUP.htm" title="А.3.4.12. RDS_COMPM_MODELCLEANUP &ndash; очистка данных модели">RDS_COMPM_MODELCLEANUP</a></span>.</dd>

  <dt><span class="cpp">NBlocks</span>&emsp;(<span class="cpp"><i>int</i></span>)</dt>
  <dd>Число блоков, к которым в данный момент подключена эта модель. Вместе с сервисной функцией
  <span class="cpp"><a href="rdscompGetModelBlock.htm" title="А.5.34.4. rdscompGetModelBlock &ndash; обслуживаемый моделью блок по номеру">rdscompGetModelBlock</a></span> может использоваться для перебора всех таких блоков.
  Функция модуля автокомпиляции не должна изменять это число.</dd>

  <dt><span class="cpp">Module</span>&emsp;(<span class="cpp"><i>RDS_COMPHANDLE</i></span>)</dt>
  <dd>Идентификатор модуля автокомпиляции (<span class="cpp"><a href="app_ids.htm#light_ref9" title="Идентификатор модуля автокомпиляции">RDS_COMPHANDLE</a></span>), к которому относится
  данная модель. Функция модуля автокомпиляции не должна изменять это поле.</dd>

  <dt><span class="cpp">CompDllName</span>&emsp;(<span class="cpp"><i>LPSTR</i></span>)</dt>
  <dd>Путь к файлу DLL, в котором будет находиться функция данной модели после компиляции. Строка
  пути размещается во внутренней памяти RDS. Функция модуля не должна изменять это поле
  непосредственно: путь к файлу DLL устанавливается сервисной функцией
  <span class="cpp"><a href="rdscompSetModelFunction.htm" title="А.5.34.13. rdscompSetModelFunction &ndash; установить имена DLL и функции скомпилированной модели">rdscompSetModelFunction</a></span> при вызове модуля автокомпиляции для реакции на событие
  <span class="cpp"><a href="RDS_COMPM_PREPARE.htm" title="А.3.4.16. RDS_COMPM_PREPARE &ndash; подготовка модели к компиляции">RDS_COMPM_PREPARE</a></span>.</dd>

  <dt><span class="cpp">CompDllFunc</span>&emsp;(<span class="cpp"><i>LPSTR</i></span>)</dt>
  <dd>Имя экспортированной функции модели блока, которая будет создана в результате компиляции данной
  модели. Строка имени размещается во внутренней памяти RDS. Функция модуля не должна изменять
  это поле непосредственно: как и имя файла DLL (<span class="cpp">CompDllName</span>), имя функции
  устанавливается сервисной функцией <span class="cpp">rdscompSetModelFunction</span> при вызове модуля
  автокомпиляции для реакции на событие <span class="cpp">RDS_COMPM_PREPARE</span>.</dd>

  <dt><span class="cpp">Valid</span>&emsp;(<span class="cpp"><i>BOOL</i></span>)</dt>
  <dd>Признак необходимости компиляции данной модели: функция модуля, реагируя на событие
  <span class="cpp"><a href="RDS_COMPM_PREPARE.htm" title="А.3.4.16. RDS_COMPM_PREPARE &ndash; подготовка модели к компиляции">RDS_COMPM_PREPARE</a></span>, записывает в это поле <span class="cpp">TRUE</span>, если модель
  не изменилась с момента прошлой компиляции и повторная компиляция не требуется. Если модель изменилась,
  в это поле необходимо записать <span class="cpp">FALSE</span>. Чаще всего необходимость компиляции
  устанавливают, сравнивая время последнего изменения текста модели с временем создания файла DLL.</dd>

  <dt><span id="ref4"><span class="cpp">AltModelName</span>&emsp;(<span class="cpp"><i>LPSTR</i></span>)</span></dt>
  <dd>Указатель на строку с <span id="light_ref4">альтернативным именем модели</span>
  во внутренней памяти RDS. Функция модуля
  не должна изменять это поле непосредственно: альтернативное имя модели устанавливается сервисной функцией
  <span class="cpp"><a href="rdscompSetAltModelName.htm" title="А.5.34.11. rdscompSetAltModelName &ndash; установить альтернативное имя модели">rdscompSetAltModelName</a></span> и запоминается в файле схемы вместе с остальными параметрами
  блока. В отличие от основного имени модели, на которое указывает поле <span class="cpp">ModelName</span>,
  альтернативное имя модели пользователь не видит и установить или изменить его вручную не может.
  Фактически, альтернативное имя модели представляет собой хранимую строку, которую модуль автокомпиляции
  может использовать в своих целях любым удобным программисту образом.</dd>

  <dt><span class="cpp">Tag</span>&emsp;(<span class="cpp"><i>int</i></span>)</dt>
  <dd>Целое поле, никак не обрабатываемое RDS.
  Программист может использовать его любым удобным способом.</dd>
</dl>

<p class="apphdr">См. также</p>
<p class="seealso"><span class="cpp"><a href="RDS_COMPM_MODELINIT.htm" title="А.3.4.13. RDS_COMPM_MODELINIT &ndash; инициализация модели">RDS_COMPM_MODELINIT</a></span>,
<span class="cpp"><a href="RDS_COMPM_MODELCLEANUP.htm" title="А.3.4.12. RDS_COMPM_MODELCLEANUP &ndash; очистка данных модели">RDS_COMPM_MODELCLEANUP</a></span>,
<span class="cpp"><a href="RDS_COMPM_PREPARE.htm" title="А.3.4.16. RDS_COMPM_PREPARE &ndash; подготовка модели к компиляции">RDS_COMPM_PREPARE</a></span>,
<span class="cpp"><a href="rdscompSetAltModelName.htm" title="А.5.34.11. rdscompSetAltModelName &ndash; установить альтернативное имя модели">rdscompSetAltModelName</a></span>,
<span class="cpp"><a href="rdscompSetModelFunction.htm" title="А.5.34.13. rdscompSetModelFunction &ndash; установить имена DLL и функции скомпилированной модели">rdscompSetModelFunction</a></span>,
<span class="cpp"><a href="rdscompRenameModel.htm" title="А.5.34.8. rdscompRenameModel &ndash; переименовать модель">rdscompRenameModel</a></span>.</p>

</div>
<p style="clear:both; min-height:1em; padding:0px; margin: 0px;"></p><hr class="off" /><div class="bottomnav">
<div class="left">
<span class="button"><a href="RDS_COMPMODULEDATA.htm" title="Предыдущий параграф" id="pgup_f">&lt;&lt;</a></span>
<span class="button"><a href="RDS_COMPM_ATTACHBLOCK.htm" title="Следующий параграф" id="pgdn_f">&gt;&gt;</a></span>
<span class="divider"></span>
<span class="button"><a href="app_index.htm#light_htm:RDS_COMPMODELDATA">Оглавление</a></span>
<span class="button"><a href="alpha.htm">Указатель</a></span>
</div>
</div>
</body>
</html>
