<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru" xml:lang="ru">
<head>
  <link rel="stylesheet" type="text/css" href="../css/main.css" />
  <link rel="stylesheet" type="text/css" href="../css/cpp.css" />
  <meta http-equiv="Content-Type" content="text/html;charset=windows-1251" />
  <script type="text/javascript" src="script.js"></script>
  <title>А.5.2.3. Макрос RDS_INTVERSION &ndash; преобразование версии RDS в целое число</title>
</head><body onload="DocLoad()">
<div class="pageheader"><span class="off"><b>Текущий раздел:</b></span>
<div class="int"><p id="top"><a href="../index.htm">Описания RDS</a></p>
<div class="level"><p><a href="app_index.htm">Приложения</a></p>
<div class="level"><p><a href="app_index.htm#light_htm:app_a">Приложение А. Функции, константы и структуры RDS</a></p>
<div class="level"><p><a href="app_index.htm#light_htm:app_a_5">А.5. Сервисные функции RDS</a></p>
<div class="level"><p><a href="app_index.htm#light_htm:app_a_5_2">А.5.2. Управление работой RDS и функции общего назначения</a></p>
<div class="level"><p>А.5.2.3. Макрос <span class="cpp">RDS_INTVERSION</span> &ndash; преобразование версии RDS в целое число</p>
</div>
</div>
</div>
</div>
</div>
</div></div>
<div class="topnav"><span class="off"><b>Навигация:</b></span>
<div class="left">
<span class="button"><a href="RDS_INITSERVSIZE.htm" title="Предыдущий параграф" id="pgup">&lt;&lt;</a></span>
<span class="button"><a href="RDS_SETFLAG.htm" title="Следующий параграф" id="pgdn">&gt;&gt;</a></span>
<span class="divider"></span>
<span class="button"><a href="app_index.htm#light_htm:RDS_INTVERSION">Оглавление</a></span>
<span class="button"><a href="alpha.htm">Указатель</a></span>
</div>
</div>

<div class="text">
<h1 class="off">Приложения</h1>
<h2 class="off">Приложение А. Функции, константы и структуры RDS</h2>
<h3 class="off">А.5. Сервисные функции RDS</h3>
<h4 class="off">А.5.2. Управление работой RDS и функции общего назначения</h4>
<h5>А.5.2.3. Макрос <span class="cpp">RDS_INTVERSION</span> &ndash; преобразование версии RDS в целое число</h5>


<p>Макрос <span class="cpp">RDS_INTVERSION</span> преобразует три компонента версии RDS (старший номер,
младший номер и номер сборки) в одно целое число, которое можно использовать для сравнения версий.</p>

<pre class="cpp">  RDS_INTVERSION(
    high,  <span class="rem">// Старший номер</span>
    low,   <span class="rem">// Младший номер</span>
    build  <span class="rem">// Номер сборки</span>
  )</pre>

<p class="apphdr">Определение</p>
<pre class="cpp">  <span class="preproc">#define RDS_INTVERSION(high,low,build) \</span>
<span class="preproc">      (((high)&lt;&lt;24) | ((low)&lt;&lt;16) | (build))</span></pre>

<p class="apphdr">Параметры</p>

<dl>
  <dt><span class="cpp">high</span>&emsp;(<span class="cpp"><i>Целое число: unsigned char, int, <a href="app_ids.htm#light_ref14" title="Беззнаковое целое 32 бита">DWORD</a> и т.п.</i></span>)</dt>
  <dd>Старший номер версии &ndash; самое первое число в трехкомпонентном названии версии (например, в названии
  версии &laquo;1.0.261&raquo; старший номер равен 1). Это число занимает один байт и может принимать значения от
  0 до 127. Более поздние версии RDS имеют больший старший номер.</dd>

  <dt><span class="cpp">low</span>&emsp;(<span class="cpp"><i>Целое число</i></span>)</dt>
  <dd>Младший номер версии &ndash; второе число в трехкомпонентном названии версии (например, в названии версии
  &laquo;1.0.261&raquo; младший номер равен 0). Это число занимает один байт и может принимать значения от 0 до
  255. При одинаковых старших номерах версий более поздние версии RDS имеют больший младший номер.</dd>

  <dt><span class="cpp">build</span>&emsp;(<span class="cpp"><i>Целое число</i></span>)</dt>
  <dd>Номер сборки &ndash; последнее число в трехкомпонентном названии версии (например, в названии версии
  &laquo;1.0.261&raquo; номер сборки равен 261). Это число занимает два байта и может принимать значения от 0
  до 65535. При одинаковых старших и младших номерах версий более поздние версии RDS имеют больший номер сборки.</dd>
</dl>

<p class="apphdr">Возвращаемое значение</p>
<p>Целое тридцатидвухбитное число, соответствующее переданным компонентам номера версии.</p>

<p class="apphdr">Примечания</p>
<p>Макрос <span class="cpp">RDS_INTVERSION</span> формирует из трех компонентов номера версии одно целое число
сдвигом влево старшего номера на 24 бита, младшего &ndash; на 16 бит, и объединения получившихся чисел операцией
битового ИЛИ с номером сборки. Именно в таком формате номер версии RDS возвращается сервисной функцией
<span class="cpp"><a href="rdsServiceVersion.htm" title="А.5.2.34. rdsServiceVersion &ndash; версия RDS">rdsServiceVersion</a></span>. Числа в этом формате можно сравнивать: если число, полученное при
помощи макроса <span class="cpp">RDS_INTVERSION</span> из одной версии больше числа, полученного из другой,
значит, первая версия старше второй.</p>

<p>Помимо макроса <span class="cpp">RDS_INTVERSION</span> в файле
&laquo;<span class="file">RdsDef.h</span>&raquo; определено четыре константы, описывающих текущую, то есть соответствующую времени
создания &laquo;<span class="file">RdsDef.h</span>&raquo;, версию RDS:</p>

<div class="tableleft"><div class="tcont">
  <table class="list">
    <tr>
      <td class="term"><span class="cpp"><span id="light_ref1">RDS_FVERSIONHIGH</span></span></td>
      <td>Старший номер текущей версии RDS.</td>
    </tr>
    <tr>
      <td class="term"><span class="cpp"><span id="light_ref2">RDS_FVERSIONLOW</span></span></td>
      <td>Младший номер текущей версии RDS.</td>
    </tr>
    <tr>
      <td class="term"><span class="cpp"><span id="light_ref3">RDS_FVERSIONBUILD</span></span></td>
      <td>Номер сборки текущей версии RDS.</td>
    </tr>
    <tr>
      <td class="term"><span class="cpp"><span id="light_ref4">RDS_FVERSION</span></span></td>
      <td>Полный номер текущей версии RDS (число, полученное из трех компонентов версии указанным выше образом).</td>
    </tr>
  </table>
</div></div>

<p class="noindent"><span id="ref5">Описания</span>
этих констант можно, при необходимости, подавить, описав константу
<span class="cpp" id="light_ref5">RDS_NOVERSIONDEFINES</span> перед включением
файла &laquo;<span class="file">RdsDef.h</span>&raquo;.</p>

<p class="apphdr">Пример</p>
<pre class="cpp">  <span class="preproc">#include &lt;windows.h&gt;</span>
  <span class="preproc">#include &lt;RdsDef.h&gt;</span>
  <span class="rem">// Подготовка описаний сервисных функций</span>
  <span class="preproc">#define </span><a class="hidden" href="app_a_5_1.htm#ref3" title="RDS_SERV_FUNC_BODY"><span class="preproc">RDS_SERV_FUNC_BODY</span></a><span class="preproc"> GetInterfaceFunctions</span>
  <span class="preproc">#include &lt;</span><a class="hidden" href="pm_2_2.htm#ref11" title="Использование RdsFunc.h"><span class="preproc">RdsFunc.h</span></a><span class="preproc">&gt;</span>
  <span class="rem">// Главная функция DLL</span>
  <span class="kw">int</span> WINAPI <a class="hidden" href="DllEntryPoint.htm" title="А.2.2. Главная функция DLL">DllEntryPoint</a>(<a class="hidden" href="app_ids.htm#light_ref17" title="Дескриптор модуля">HINSTANCE</a> <span class="rem">/*hinst*/</span>,
                           <span class="kw">unsigned</span> <span class="kw">long</span> reason,
                           <span class="kw">void</span>* <span class="rem">/*lpReserved*/</span>)
  { <span class="kw">if</span>(reason==DLL_PROCESS_ATTACH) <span class="rem">// Загрузка DLL</span>
      { <span class="kw">int</span> version;
        <span class="rem">// Получение доступа к функциям</span>
        GetInterfaceFunctions();
        <span class="rem">// Проверка наличия функции получения версии</span>
        <span class="kw">if</span>(rdsServiceVersion==NULL) <span class="rem">// Нет функции</span>
          { MessageBox(NULL,<span class="str">"Эта DLL не работает без RDS"</span>,<span class="str">"Ошибка"</span>,MB_OK);
            <span class="kw">return</span> <span class="const">1</span>;
          }
        <span class="rem">// Получение версии RDS</span>
        version=<a class="hidden" href="rdsServiceVersion.htm" title="А.5.2.34. rdsServiceVersion &ndash; версия RDS">rdsServiceVersion</a>();
        <span class="kw">if</span>(version&lt;RDS_INTVERSION(<span class="const">1</span>,<span class="const">0</span>,<span class="const">120</span>))
          MessageBox(NULL,<span class="str">"Нужна версия RDS не ниже 1.0.120"</span>,
              <span class="str">"Ошибка"</span>,MB_OK);
      }
    <span class="kw">return</span> <span class="const">1</span>;
  }</pre>


<p class="apphdr">См. также</p>
<p class="seealso"><span class="cpp"><a href="rdsServiceVersion.htm" title="А.5.2.34. rdsServiceVersion &ndash; версия RDS">rdsServiceVersion</a></span></p>

</div>
<p style="clear:both; min-height:1em; padding:0px; margin: 0px;"></p><hr class="off" /><div class="bottomnav">
<div class="left">
<span class="button"><a href="RDS_INITSERVSIZE.htm" title="Предыдущий параграф" id="pgup_f">&lt;&lt;</a></span>
<span class="button"><a href="RDS_SETFLAG.htm" title="Следующий параграф" id="pgdn_f">&gt;&gt;</a></span>
<span class="divider"></span>
<span class="button"><a href="app_index.htm#light_htm:RDS_INTVERSION">Оглавление</a></span>
<span class="button"><a href="alpha.htm">Указатель</a></span>
</div>
</div>
</body>
</html>
