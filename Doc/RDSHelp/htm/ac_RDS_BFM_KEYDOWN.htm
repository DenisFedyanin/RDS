<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru" xml:lang="ru">
<head>
  <link rel="stylesheet" type="text/css" href="../css/main.css" />
  <link rel="stylesheet" type="text/css" href="../css/cpp.css" />
  <meta http-equiv="Content-Type" content="text/html;charset=windows-1251" />
  <script type="text/javascript" src="script.js"></script>
  <title>&sect;3.8.4.5. Нажатие клавиши</title>
</head><body onload="DocLoad()">
<div class="pageheader"><span class="off"><b>Текущий раздел:</b></span>
<div class="int"><p id="top"><a href="../index.htm">Описания RDS</a></p>
<div class="level"><p><a href="um_index.htm">Описание пользователя</a></p>
<div class="level"><p><a href="um_index.htm#light_htm:um_3">Глава 3. Использование стандартных модулей автокомпиляции</a></p>
<div class="level"><p><a href="um_index.htm#light_htm:um_3_8">&sect;3.8. Краткий перечень вводимых в модель описаний и реакций на события</a></p>
<div class="level"><p><a href="um_index.htm#light_htm:um_3_8_4">&sect;3.8.4. Реакции блока на мышь и клавиатуру</a></p>
<div class="level"><p>&sect;3.8.4.5. Нажатие клавиши</p>
</div>
</div>
</div>
</div>
</div>
</div></div>
<div class="topnav"><span class="off"><b>Навигация:</b></span>
<div class="left">
<span class="button"><a href="ac_RDS_BFM_MOUSEMOVE.htm" title="Предыдущий параграф" id="pgup">&lt;&lt;</a></span>
<span class="button"><a href="ac_RDS_BFM_KEYUP.htm" title="Следующий параграф" id="pgdn">&gt;&gt;</a></span>
<span class="divider"></span>
<span class="button"><a href="um_index.htm#light_htm:ac_RDS_BFM_KEYDOWN">Оглавление</a></span>
<span class="button"><a href="alpha.htm">Указатель</a></span>
</div>
</div>

<div class="text">
<h1 class="off">Описание пользователя</h1>
<h2 class="off">Глава 3. Использование стандартных модулей автокомпиляции</h2>
<h3 class="off">&sect;3.8. Краткий перечень вводимых в модель описаний и реакций на события</h3>
<h4 class="off">&sect;3.8.4. Реакции блока на мышь и клавиатуру</h4>
<h5>&sect;3.8.4.5. Нажатие клавиши</h5>


<p>Это событие возникает в режимах
<a href="um_1_3.htm#ref2" title="Режим моделирования">моделирования</a> и
<a href="um_1_3.htm#ref3" title="Режим расчета">расчета</a> при нажатии пользователем какой-либо клавиши на клавиатуре,
если окно подсистемы с данным блоком имеет фокус (то есть, это самое верхнее окно, и
RDS при этом &ndash; активное приложение) и на вкладке &laquo;<span class="menu">DLL</span>&raquo; окна параметров блока включен
флажок &laquo;<span class="menu">блок реагирует на клавиатуру</span>&raquo;
(<a href="#pic1" title="Разрешение реакции на клавиатуру в окне параметров блока">рис.&nbsp;483</a>).</p>

<div class="pic"><div class="container" id="pic1">
<img src="../img/AC_blockparams_enablekeyboard.png" width="534" height="407" alt="Разрешение реакции на клавиатуру в окне параметров блока" />
<p id="light_pic1">Рис.&nbsp;483. Разрешение реакции на клавиатуру в окне параметров блока</p>
</div></div>


<p><span id="ref1">Реакция</span> на нажатие клавиши вводится на вкладке &laquo;<span class="menu"><a href="um_3_6_4.htm" title="&sect;3.6.4. Описания программы и реакции блока на события">события</a></span>&raquo;
левой панели редактора модели: раздел &laquo;<span class="menu">мышь и клавиатура</span>&raquo;, подраздел
&laquo;<span class="menu">нажатие клавиши</span>&raquo;. В классе блока для нее создается функция с именем
<span class="cpp" id="light_ref1">rdsbcppKeyDown</span> следующего вида:</p>

<pre class="cpp">  // <span id="ref2">Нажатие</span> клавиши
  void rdsbcppBlockClass::rdsbcppKeyDown(
                            <a class="hidden" href="RDS_BFM_KEYDOWN.htm#ref3" title="Указатель на RDS_KEYDATA">RDS_PKEYDATA</a> <span id="light_ref2">KeyData</span>,int &amp;Result)
  {
    <span class="changes"><i>&nbsp;&hellip; пользовательский текст реакции &hellip;&nbsp;</i></span>
  }</pre>

<p>В параметре <span class="cpp">KeyData</span> в функцию передается указатель на структуру описания события
<span class="cpp"><a href="RDS_BFM_KEYDOWN.htm#ref2" title="Структура RDS_KEYDATA">RDS_KEYDATA</a></span>:</p>

<pre class="cpp">  typedef struct {
    int KeyCode;     // Виртуальный код клавиши
    <a class="hidden" href="app_ids.htm#light_ref11" title="Логический тип Windows API">BOOL</a> Repeat;     // Признак автоповтора
    int RepeatCount; // Число повторений
    <a class="hidden" href="app_ids.htm#light_ref14" title="Беззнаковое целое 32 бита">DWORD</a> Shift;     // Флаги клавиатуры (RDS_M*, RDS_K*)
    int KeyEvent     // Событие - RDS_BFM_KEYDOWN или RDS_BFM_KEYUP
    <a class="hidden" href="app_ids.htm#light_ref11" title="Логический тип Windows API">BOOL</a> Handled;    // Событие обработано (возврат)
    int Viewport;    // Номер порта вывода или -1
  } <a class="hidden" href="RDS_BFM_KEYDOWN.htm#ref2" title="Структура RDS_KEYDATA">RDS_KEYDATA</a>;
  typedef <a class="hidden" href="RDS_BFM_KEYDOWN.htm#ref2" title="Структура RDS_KEYDATA">RDS_KEYDATA</a> *<a class="hidden" href="RDS_BFM_KEYDOWN.htm#ref3" title="Указатель на RDS_KEYDATA">RDS_PKEYDATA</a>;</pre>

<p>Поля структуры имеют следующий смысл:</p>
<dl>
  <dt><span class="cpp">KeyCode</span>&emsp;(<span class="cpp"><i>int</i></span>)</dt>
  <dd>Виртуальный код нажатой клавиши (<span class="cpp">VK_*</span>) согласно описаниям Windows API.</dd>

  <dt><span class="cpp">Repeat</span>&emsp;(<span class="cpp"><i><a href="app_ids.htm#light_ref11" title="Логический тип Windows API">BOOL</a></i></span>)</dt>
  <dd><span class="cpp">TRUE</span>, если нажатие клавиши сгенерировано автоповтором клавиатуры, и
  <span class="cpp">FALSE</span> в противном случае (при одиночных нажатиях клавиш в этом поле всегда
  находится <span class="cpp">FALSE</span>).</dd>

  <dt><span class="cpp">RepeatCount</span>&emsp;(<span class="cpp"><i>int</i></span>)</dt>
  <dd>При автоповторе нажатия клавиши (<span class="cpp">Repeat==TRUE</span>) &ndash; число повторов с момента
  прошлого вызова реакции на событие.</dd>

  <dt><span class="cpp">Shift</span>&emsp;(<span class="cpp"><i><a href="app_ids.htm#light_ref14" title="Беззнаковое целое 32 бита">DWORD</a></i></span>)</dt>
  <dd>Набор битовых флагов, описывающих клавиши и кнопки, которые были нажатыми в момент возникновения события:
  <span class="cpp">RDS_MLEFTBUTTON</span>, <span class="cpp">RDS_MRIGHTBUTTON</span>, <span class="cpp">RDS_MMIDDLEBUTTON</span>
  &ndash; нажатые кнопки мыши (см. выше),
  <span class="cpp"><span id="light_ref3">RDS_KSHIFT</span></span> &ndash; нажата клавиша <span class="keys">Shift</span>,
  <span class="cpp"><span id="light_ref4">RDS_KALT</span></span> &ndash; нажата клавиша <span class="keys">Alt</span>,
  <span class="cpp"><span id="light_ref5">RDS_KCTRL</span></span> &ndash; нажата клавиша <span class="keys">Ctrl</span>.</dd>

  <dt><span class="cpp">KeyEvent</span>&emsp;(<span class="cpp"><i>int</i></span>)</dt>
  <dd>Константа, указывающая на произошедшее событие (нажатие или отпускание клавиши). Поскольку в автокомпилируемых
  моделях для каждого из этих событий создается отдельная функция, это поле структуры используется крайне редко.</dd>

  <dt><span class="cpp">Handled</span>&emsp;(<span class="cpp"><i>BOOL</i></span>)</dt>
  <dd>Перед вызовом самого первого блока подсистемы (когда подсистема на переднем плане, о нажатии клавиш по
  очереди информируются все ее блоки) это поле устанавливается в <span class="cpp">FALSE</span>. Модель блока
  может присвоит ему <span class="cpp">TRUE</span> для того, чтобы сообщить RDS об успешной обработке
  нажатия клавиши и о том, что дальше перебирать блоки, информируя их о нажатии, не нужно.</dd>

  <dt><span class="cpp">Viewport</span>&emsp;(<span class="cpp"><i>int</i></span>)</dt>
  <dd>Номер <a href="pm_index.htm#light_htm:pm_3_6" title="&sect;3.6. Отображение схемы RDS в собственном окне приложения">порта вывода</a>, из которого пришла информация о событии
  (нажатии, отпускании кнопки, перемещении курсора и т.п.), или &minus;1, если событие произошло в
  обычном окне подсистемы.</dd>
</dl>

<p class="noindent">Чаще всего в этой структуре используются поле <span class="cpp">KeyCode</span>, содержащее
код нажатой клавиши, и поле <span class="cpp">Shift</span>, содержащее набор битовых флагов, соответствующих
одновременно нажатым служебным клавишам <span class="keys">Shift</span>,
<span class="keys">Alt</span> и <span class="keys">Ctrl</span>.</p>

<p>Второй параметр функции реакции &ndash; это ссылка на целую переменную <span class="cpp">Result</span>.
Через этот параметр модель может сообщить RDS, обработала ли она нажатие клавиши. Для этого параметру
<span class="cpp">Result</span> нужно присвоить одну из двух стандартных констант:</p>

<ul>
  <li><span class="cpp"><span id="light_ref6">RDS_BFR_DONE</span></span> &ndash; нажатие клавиши не обработано блоком,
  RDS будет продолжать перебирать блоки подсистемы. пока один из них не обработает нажатие;</li>

  <li><span class="cpp"><span id="light_ref7">RDS_BFR_STOP</span></span> &ndash; нажатие клавиши обработано,
  его не нужно передавать в остальные блоки подсистемы и вызывать соответствующий ей пункт главного меню
  RDS, если такой имеется.</li>
</ul>

<p>По умолчанию в <span class="cpp">Result</span> записано значение
<span class="cpp">RDS_BFR_DONE</span>, поэтому, если в реакции на событие этому параметру ничего не
будет присвоено, блок будет считаться успешно обработавшим нажатие.</p>

<p>При написании моделей блоков без использования модуля автокомпиляции нажатию клавиши соответствует
константа RDS <span class="cpp"><a href="RDS_BFM_KEYDOWN.htm" title="А.2.6.5. RDS_BFM_KEYDOWN &ndash; нажатие клавиши">RDS_BFM_KEYDOWN</a></span>.</p>

</div>
<p style="clear:both; min-height:1em; padding:0px; margin: 0px;"></p><hr class="off" /><div class="bottomnav">
<div class="left">
<span class="button"><a href="ac_RDS_BFM_MOUSEMOVE.htm" title="Предыдущий параграф" id="pgup_f">&lt;&lt;</a></span>
<span class="button"><a href="ac_RDS_BFM_KEYUP.htm" title="Следующий параграф" id="pgdn_f">&gt;&gt;</a></span>
<span class="divider"></span>
<span class="button"><a href="um_index.htm#light_htm:ac_RDS_BFM_KEYDOWN">Оглавление</a></span>
<span class="button"><a href="alpha.htm">Указатель</a></span>
</div>
</div>
</body>
</html>
