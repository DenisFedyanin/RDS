<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru" xml:lang="ru">
<head>
  <link rel="stylesheet" type="text/css" href="../css/main.css" />
  <link rel="stylesheet" type="text/css" href="../css/cpp.css" />
  <meta http-equiv="Content-Type" content="text/html;charset=windows-1251" />
  <script type="text/javascript" src="script.js"></script>
  <title>&sect;3.8.3.1. Выполнение такта расчета</title>
</head><body onload="DocLoad()">
<div class="pageheader"><span class="off"><b>Текущий раздел:</b></span>
<div class="int"><p id="top"><a href="../index.htm">Описания RDS</a></p>
<div class="level"><p><a href="um_index.htm">Описание пользователя</a></p>
<div class="level"><p><a href="um_index.htm#light_htm:um_3">Глава 3. Использование стандартных модулей автокомпиляции</a></p>
<div class="level"><p><a href="um_index.htm#light_htm:um_3_8">&sect;3.8. Краткий перечень вводимых в модель описаний и реакций на события</a></p>
<div class="level"><p><a href="um_index.htm#light_htm:um_3_8_3">&sect;3.8.3. Моделирование и переключение режимов</a></p>
<div class="level"><p>&sect;3.8.3.1. Выполнение такта расчета</p>
</div>
</div>
</div>
</div>
</div>
</div></div>
<div class="topnav"><span class="off"><b>Навигация:</b></span>
<div class="left">
<span class="button"><a href="ac_RDS_BFM_UNLOADSYSTEM.htm" title="Предыдущий параграф" id="pgup">&lt;&lt;</a></span>
<span class="button"><a href="ac_RDS_BFM_STARTCALC.htm" title="Следующий параграф" id="pgdn">&gt;&gt;</a></span>
<span class="divider"></span>
<span class="button"><a href="um_index.htm#light_htm:ac_RDS_BFM_MODEL">Оглавление</a></span>
<span class="button"><a href="alpha.htm">Указатель</a></span>
</div>
</div>

<div class="text">
<h1 class="off">Описание пользователя</h1>
<h2 class="off">Глава 3. Использование стандартных модулей автокомпиляции</h2>
<h3 class="off">&sect;3.8. Краткий перечень вводимых в модель описаний и реакций на события</h3>
<h4>&sect;3.8.3. Моделирование и переключение режимов</h4>
<p class="abstract">Рассматриваются реакции на события, связанные с переключением режимов RDS, работой в режиме расчета и изменением <a href="um_3_6_3.htm" title="&sect;3.6.3. Динамические переменные блока">динамических переменных</a>.</p>
<h5>&sect;3.8.3.1. Выполнение такта расчета</h5>


<p>Выполнение <a href="um_1_3.htm#ref4" title="Такт расчета">такта расчета</a>
&ndash; это самое часто используемое в моделях событие. В режиме расчета оно в каждом такте возникает
у всех <a href="um_1_2.htm#light_ref9" title="Простой блок">простых блоков</a>, у которых
<a href="um_2_9_1.htm#light_ref8" title="Установка режима запуска блока">установлен флаг запуска</a>
в каждом такте или взведен входной сигнал готовности (обычно он называется
&laquo;<span class="rdsvar"><a href="um_1_4.htm#ref25" title="Сигнал запуска блока">Start</a></span>&raquo;, см. пример
в <a href="um_3_7_2_1.htm" title="&sect;3.7.2.1. Модели с простыми статическими переменными">&sect;3.7.2.1</a>). Многие простейшие модели автокомпилируемых блоков
состоят только из реакции на это событие. Как правило, в реакции на него модель блока вычисляет значения
выходов по значениям входов,
<a href="um_3_6_6.htm" title="&sect;3.6.6. Настроечные параметры блока">настроечных параметров</a>,
<a href="um_3_6_3.htm" title="&sect;3.6.3. Динамические переменные блока">динамических переменных</a> и т.п. Примеры использования этого события во
множестве содержатся в <a href="um_index.htm#light_htm:um_3_7" title="&sect;3.7. Принципы создания автокомпилируемых моделей блоков">&sect;3.7</a>.</p>

<p><span id="ref1">Реакция</span> на выполнение такта расчета вводится
на вкладке &laquo;<span class="menu"><a href="um_3_6_4.htm" title="&sect;3.6.4. Описания программы и реакции блока на события">события</a></span>&raquo; левой панели редактора модели: раздел
&laquo;<span class="menu">моделирование и режимы</span>&raquo;, подраздел &laquo;<span class="menu">модель</span>&raquo;. При создании новой пустой модели
вкладка для ввода этой реакции открывается автоматически. В классе блока для нее создается функция
с именем <span class="cpp" id="light_ref1">rdsbcppModel</span>:</p>

<pre class="cpp">  // Один такт моделирования
  void rdsbcppBlockClass::rdsbcppModel(RDS_PINITIALCALCDATA InitialCalc)
  {
    <span class="changes"><i>&nbsp;&hellip; пользовательский текст реакции &hellip;&nbsp;</i></span>
  }</pre>

<p>Реакция на
<span id="ref2">выполнение</span>
такта расчета может также вызываться и при так называемом
<span id="light_ref2"><a href="um_1_3.htm#ref6" title="Инициализационный (предварительный) расчет">инициализационном</a>,
или предварительном, расчете</span>. Предварительный расчет выполняется в момент выхода из
<a href="um_1_3.htm#ref1" title="Режим редактирования">режима редактирования</a> по запросу некоторых блоков &ndash; например,
полей ввода. Он позволяет уменьшить число тактов переходного процесса в алгебраических цепочках,
подключенных к таким блокам. Если, например, к полю ввода подключена цепочка из трех
последовательно соединенных сумматоров или блоков умножения на константу, правильное
значение на выходе третьего
блока цепочки установится только через три такта после запуска расчета
(см. <a href="um_1_4.htm#pic4" title="Две ветви алгебраических блоков">рис.&nbsp;10</a>). Если же эти сумматоры или блоки умножения
на константу поддерживают предварительный расчет, правильное значение установится на
выходе непосредственно перед запуском расчета, поскольку все блоки цепочки будут последовательно
вызваны для реакции на такт расчета (хотя расчет еще не идет) и их данные будут
переданы на вход следующих блоков в момент выхода из режима редактирования. Для того, чтобы блок
вызывался при предварительном расчете, в
<a href="um_3_6_7.htm#light_ref10" title="Флаг инициализационного расчета">параметрах его модели</a>
должен быть включен флажок &laquo;<span class="menu">блок участвует в инициализационном расчете</span>&raquo;.
Чтобы блок начинал предварительный расчет, необходимо также включить флажок
&laquo;<span class="menu">блок начинает инициализационный расчет</span>&raquo;.</p>

<p><span id="ref3">В</span>
большинстве случаев разработчику модели можно не задумываться над тем, вызвана данная реакция,
как и положено, в нормальном режиме расчета, или при предварительном расчете. При необходимости,
о причине вызова можно узнать по передаваемому в функцию указателю <span class="cpp">InitCalc</span>. В
режиме расчета этот параметр будет равен <span class="cpp">NULL</span>, при предварительном расчете он
будет указывать на структуру <span class="cpp" id="light_ref3">RDS_INITIALCALCDATA</span>,
содержащую единственное поле <span class="cpp">FirstInChain</span> типа <span class="cpp"><a href="app_ids.htm#light_ref11" title="Логический тип Windows API">BOOL</a></span>.
В этом поле будет находиться значение <span class="cpp">TRUE</span>, если блок был вызван из-за того,
что он сам начинает предварительный расчет, и значение <span class="cpp">FALSE</span>, если он
вызван из-за прихода на вход данных от другого блока в процессе предварительного расчета.</p>

<p>Здесь не приводятся примеры блоков, поддерживающих инициализационный расчет &ndash;
в простых моделях вполне можно обойтись и без него, задержка данных на несколько тактов после
запуска расчета, как правило, не влияет на работоспособность схемы.</p>

<p>При написании моделей блоков без использования модуля автокомпиляции событию такта расчета соответствует
константа RDS <span class="cpp"><a href="RDS_BFM_MODEL.htm" title="А.2.4.9. RDS_BFM_MODEL &ndash; выполнение такта расчета">RDS_BFM_MODEL</a></span>.</p>

</div>
<p style="clear:both; min-height:1em; padding:0px; margin: 0px;"></p><hr class="off" /><div class="bottomnav">
<div class="left">
<span class="button"><a href="ac_RDS_BFM_UNLOADSYSTEM.htm" title="Предыдущий параграф" id="pgup_f">&lt;&lt;</a></span>
<span class="button"><a href="ac_RDS_BFM_STARTCALC.htm" title="Следующий параграф" id="pgdn_f">&gt;&gt;</a></span>
<span class="divider"></span>
<span class="button"><a href="um_index.htm#light_htm:ac_RDS_BFM_MODEL">Оглавление</a></span>
<span class="button"><a href="alpha.htm">Указатель</a></span>
</div>
</div>
</body>
</html>
