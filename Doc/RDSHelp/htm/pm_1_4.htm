<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru" xml:lang="ru">
<head>
  <link rel="stylesheet" type="text/css" href="../css/main.css" />
  <link rel="stylesheet" type="text/css" href="../css/cpp.css" />
  <meta http-equiv="Content-Type" content="text/html;charset=windows-1251" />
  <script type="text/javascript" src="script.js"></script>
  <title>&sect;1.4. Параметры и внешний вид блоков</title>
</head><body onload="DocLoad()">
<div class="pageheader"><span class="off"><b>Текущий раздел:</b></span>
<div class="int"><p id="top"><a href="../index.htm">Описания RDS</a></p>
<div class="level"><p><a href="pm_index.htm">Руководство программиста</a></p>
<div class="level"><p><a href="pm_index.htm#light_htm:pm_1">Глава 1. Устройство RDS</a></p>
<div class="level"><p>&sect;1.4. Параметры и внешний вид блоков</p>
</div>
</div>
</div>
</div></div>
<div class="topnav"><span class="off"><b>Навигация:</b></span>
<div class="left">
<span class="button"><a href="pm_1_3.htm" title="Предыдущий параграф" id="pgup">&lt;&lt;</a></span>
<span class="button"><a href="pm_1_5.htm" title="Следующий параграф" id="pgdn">&gt;&gt;</a></span>
<span class="divider"></span>
<span class="button"><a href="pm_index.htm#light_htm:pm_1_4">Оглавление</a></span>
<span class="button"><a href="alpha.htm">Указатель</a></span>
</div>
</div>

<div class="text">
<h1 class="off">Руководство программиста</h1>
<h2 class="off">Глава 1. Устройство RDS</h2>
<h3>&sect;1.4. Параметры и внешний вид блоков</h3>
<p class="abstract">Описывается внутренняя структура блоков RDS, способы задания их внешнего вида в окне подсистем, возможности взаимодействия блоков с пользователем.</p>


<p>Помимо модели блока, на его поведение и внешний вид влияют различные параметры. Эти параметры могут 
различаться у разных блоков с одной и той же моделью, что позволяет использовать одну модель для целого семейства 
похожих блоков. Например, стандартные блоки числовой индикации и ввода числа используют одну и ту же функцию модели из 
библиотеки &laquo;<span class="file">Common.dll</span>&raquo;.</p>

<p><span id="ref1">Каждый</span>
 блок схемы имеет <span class="term" id="light_ref1">имя</span>, уникальное в пределах 
<a href="pm_1_2.htm#ref7" title="Родительская подсистема">родительской подсистемы</a>. 
Имя блока &ndash; это строка произвольной длины, которая не может содержать символов двоеточия, доллара и 
коммерческого AT (&laquo;:&raquo;, &laquo;$&raquo; и &laquo;@&raquo;).  При создании нового блока или 
загрузке его из библиотеки имя ему присваивается автоматически, позже оно может быть изменено пользователем 
(<a href="#pic1" title="Параметры блока &ndash; общие">рис.&nbsp;5</a>) 
или 
<a href="rdsRenameBlock.htm" title="А.5.6.42. rdsRenameBlock &ndash; переименовать блок">сервисной функцией</a>. Для удобства пользователя имя блока обычно 
отображается в окне подсистемы непосредственно под изображением этого блока, но, при необходимости, оно 
может быть 
<a href="um_2_6.htm#light_ref10" title="Положение имени блока">перемещено</a>
или вообще отключено. 
<span class="term"><span id="light_ref2">Полное имя блока</span></span> начинается с двоеточия, за которым следует 
последовательное перечисление через двоеточие всех имен подсистем на пути от корневой подсистемы до этого блока, 
которое завершается именем самого блока. Например, полное имя &laquo;<span class="rdsvar">:Sys1:Sys100:Block1</span>&raquo; говорит о том, 
что блок с именем &laquo;<span class="rdsvar">Block1</span>&raquo; находится в подсистеме &laquo;<span class="rdsvar">Sys100</span>&raquo;, которая, в свою очередь, 
находится в подсистеме &laquo;<span class="rdsvar">Sys1</span>&raquo; корневой подсистемы. Полное имя блока в схеме всегда уникально.</p>

<div class="pic"><div class="container" id="pic1">
<img src="../img/SimpleBlockParams_gen.png" width="534" height="318" alt="Параметры блока &ndash; общие" />
<p id="light_pic1">Рис.&nbsp;5. Параметры блока &ndash; общие</p>
</div></div>


<p><span class="term"><span id="light_ref3">Комментарий блока</span></span> &ndash; это 
произвольный текст, связанный с блоком, который может быть задан пользователем (в окне параметров блока) 
или <a href="rdsSetBlockComment.htm" title="А.5.6.45. rdsSetBlockComment &ndash; задать комментарий блока">сервисными функциями</a>. RDS позволяет 
<a href="um_2_15_1.htm" title="&sect;2.15.1. Выделение блоков и связей по заданному критерию">искать и выделять</a>
блоки, содержащие какой-либо текст в комментарии. При необходимости, модель блока может хранить в комментарии 
какие-либо данные в текстовом виде, однако, для этого есть более удобные способы.</p>

<p>Внешний вид блока в окне подсистемы может задаваться одним из трех способов: картинкой, прямоугольником с 
текстом, или рисоваться моделью блока (<a href="#pic2" title="Параметры блока &ndash; внешний вид">рис.&nbsp;6</a>).</p>

<div class="pic"><div class="container" id="pic2">
<img src="../img/BlockPref_Appearance.png" width="534" height="463" alt="Параметры блока &ndash; внешний вид" />
<p id="light_pic2">Рис.&nbsp;6. Параметры блока &ndash; внешний вид</p>
</div></div>


<p><span class="term"><span id="light_ref4">Картинка блока</span></span> &ndash; это набор векторных 
элементов: прямоугольников, линий, многоугольников, блоков текста и т.п. Некоторые элементы и группы элементов 
могут быть связаны с переменными блока, в этом случае в режимах моделирования и расчета внешний вид блока будет 
отражать изменения этих переменных &ndash; элементы будут появляться, исчезать, перемещаться и поворачиваться, 
будет меняться их текст, цвет и т.п. Картинка задается в 
<a href="um_2_10_1.htm" title="&sect;2.10.1. Общие сведения о редакторе картинки">векторном редакторе</a>, встроенном в RDS, который вызывается из вкладки 
&laquo;<span class="menu">Внешний вид</span>&raquo; окна параметров блока кнопкой &laquo;<span class="menu">Изменить</span>&raquo;. Если для блока задано 
отображение картинкой, а сама картинка не задана, блок будет иметь стандартный внешний вид, определяемый его 
типом.</p>

<p>Прямоугольник с текстом обычно используется в тех случаях, когда блоку не требуется анимированное векторное 
изображение &ndash; для большинства простых блоков достаточно названия в прямоугольной рамке. В окне параметров 
блока можно задать цвет прямоугольника, шрифт, текст (может быть несколько строк) и выравнивание текста внутри 
прямоугольника. Связать текст с какой-либо переменной блока в этом случае нельзя.</p>

<p>Рисование функцией модели &ndash; самый сложный способ задания внешнего вида блока. Модель может использовать 
стандартные функции Windows API (в модель передается контекст, на котором нужно рисовать) или 
<a href="app_index.htm#light_htm:app_a_5_18" title="А.5.18. Графические функции">сервисные функции-оболочки</a> RDS. Рисование целесообразно применять 
для сложных блоков, внешний вид которых 
зависит от многих параметров (например, для графиков). Программное рисование внешнего вида блока рассматривается в 
<a href="pm_index.htm#light_htm:pm_2_10" title="&sect;2.10. Программное рисование внешнего вида блока">&sect;2.10</a>.</p>

<p>Независимо от способа задания внешнего вида блока, его модель может нарисовать какие-либо дополнительные 
элементы поверх изображения (для этого существует 
<a href="RDS_BFM_DRAWADDITIONAL.htm" title="А.2.6.4. RDS_BFM_DRAWADDITIONAL &ndash; дополнительное рисование">специальное событие</a>, на которое может отреагировать модель, 
см. <a href="pm_2_10_3.htm" title="&sect;2.10.3. Дополнительное рисование">&sect;2.10.3</a>). Можно, например, отображать таким образом состояние блока, или 
привлечь внимание пользователя к блоку, перечеркнув его изображение при возникновении каких-либо ошибок.</p>

<p><span class="term">Способ запуска</span> блока определяет момент срабатывания модели блока в 
<a href="pm_1_3.htm#ref3" title="Режим расчета">режиме расчета</a>. 
<span id="ref5">При</span> запуске 
<span class="term" id="light_ref5">по сигналу</span> модель будет запущена только в том случае, если значение 
первой статической переменной блока (<span class="cpp">Start</span>) будет равно единице. 
<span id="ref6">При</span> запуске 
<span class="term" id="light_ref6">каждый такт</span> 
(см. <a href="#pic1" title="Параметры блока &ndash; общие">рис.&nbsp;5</a>) 
модель будет запускаться постоянно независимо от значения переменной. Этот параметр может быть изменен как 
пользователем, так и вызовом 
<a href="rdsSetBlockFlags.htm" title="А.5.6.46. rdsSetBlockFlags &ndash; установить флаги параметров блока">сервисной функции</a>
из модели блока.</p>

<p>Отдельная группа параметров разрешает или запрещает реакцию блока на действия пользователя 
(<a href="#pic3" title="Параметры блока &ndash; модель и реакции">рис.&nbsp;7</a>). Например, для того, чтобы блоки реагировали 
на нажатие кнопок мыши, нужно не только включить в модель обработку 
<a href="RDS_BFM_MOUSEDOWN.htm" title="А.2.6.9. RDS_BFM_MOUSEDOWN &ndash; нажатие кнопки мыши">соответствующего события</a>, но и разрешить 
реакцию на мышь в параметрах конкретных блоков с этой моделью. Можно разрешить или запретить следующие 
реакции:</p>

<div class="pic"><div class="container" id="pic3">
<img src="../img/SimpleBlockParams_dll.png" width="534" height="406" alt="Параметры блока &ndash; модель и реакции" />
<p id="light_pic3">Рис.&nbsp;7. Параметры блока &ndash; модель и реакции</p>
</div></div>


<ul>
  <li>реакция на мышь: нажатие и отпускание кнопок мыши и перемещение курсора с нажатыми кнопками;</li>
  <li>перемещение курсора мыши без нажатия кнопок (включается, только если включена реакция на мышь);</li>
  <li><span class="term"><span id="light_ref7">функция настройки</span></span> &ndash; 
  специальный вызов модели для ввода параметров блока, который связан с пунктом &laquo;<span class="menu">Настройка</span>&raquo; 
  контекстного меню этого блока в <a href="pm_1_3.htm#ref1" title="Режим редактирования">режиме редактирования</a>
  (при желании, можно изменить имя этого пункта);</li>
  <li>всплывающая подсказка блока &ndash; модель блока может сформировать текст подсказки 
  (см. <a href="pm_2_11.htm" title="&sect;2.11. Отображение всплывающих подсказок к блокам">&sect;2.11</a>) и, при необходимости, указать время, которое подсказка 
  будет отображаться;</li>
  <li>реакция на клавиатуру;</li>
  <li><a href="um_2_11_4.htm#light_ref8" title="Вкладка DLL окна параметров подсистемы">для подсистем</a>
  можно также разрешить реакцию на мышь и клавиатуру в окне этой подсистемы, если ни один блок 
  внутри этой подсистемы не среагировал на событие.</li>
</ul>

<p class="noindent">Если для блока разрешена функция настройки, можно также включить ее вызов по двойному щелчку в 
режиме редактирования (см. <a href="#pic1" title="Параметры блока &ndash; общие">рис.&nbsp;5</a>, по умолчанию по 
двойному щелчку открывается окно параметров блока).</p>

<p><span id="ref8">Кроме</span>
стандартных, блок может иметь произвольное количество специализированных параметров, с которыми может 
работать только его модель. Для хранения таких параметров предназначена 
<span class="term" id="light_ref8">личная область данных</span> блока. Для каждого блока в 
RDS хранится указатель на область памяти, которая может создаваться (в языке C++ &ndash; при помощи оператора 
<span class="cpp">new</span> или функции <span class="cpp">malloc</span>) и освобождаться (в C++ &ndash; оператором 
<span class="cpp">delete</span> или функцией <span class="cpp">free</span>) моделью блока. RDS не имеет доступа 
к личной области данных блока, все действия по ее обслуживанию должны выполняться в модели. При создании нового 
блока указателю на личную область данных присваивается нулевое значение (<span class="cpp">NULL</span>), после чего 
RDS больше никогда к нему не обращается. Если модель отвела себе память под личную область и хранит там 
какие-либо параметры, она должна освободить эту область самостоятельно при уничтожении блока, иначе возможны утечки 
памяти. Поскольку RDS не работает с личной областью, при записи и загрузке схемы все действия по сохранению и 
загрузке параметров, которые хранятся в личной области, а также по созданию пользовательского интерфейса для 
редактирования этих параметров тоже должны выполняться моделью блока. Обычно для редактирования параметров используется 
функция настройки блока (пример модели с функцией настройки параметров приведен 
в <a href="pm_2_7_1.htm#light_ref7" title="Пример простейшего окна настройки блока">&sect;2.7.1</a>).</p>

</div>
<p style="clear:both; min-height:1em; padding:0px; margin: 0px;"></p><hr class="off" /><div class="bottomnav">
<div class="left">
<span class="button"><a href="pm_1_3.htm" title="Предыдущий параграф" id="pgup_f">&lt;&lt;</a></span>
<span class="button"><a href="pm_1_5.htm" title="Следующий параграф" id="pgdn_f">&gt;&gt;</a></span>
<span class="divider"></span>
<span class="button"><a href="pm_index.htm#light_htm:pm_1_4">Оглавление</a></span>
<span class="button"><a href="alpha.htm">Указатель</a></span>
</div>
</div>
</body>
</html>
