<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru" xml:lang="ru">
<head>
  <link rel="stylesheet" type="text/css" href="../css/main.css" />
  <link rel="stylesheet" type="text/css" href="../css/cpp.css" />
  <meta http-equiv="Content-Type" content="text/html;charset=windows-1251" />
  <script type="text/javascript" src="script.js"></script>
  <title>А.5.14.3. rdsClearRuntimeType &ndash; очистка переменной произвольного типа</title>
</head><body onload="DocLoad()">
<div class="pageheader"><span class="off"><b>Текущий раздел:</b></span>
<div class="int"><p id="top"><a href="../index.htm">Описания RDS</a></p>
<div class="level"><p><a href="app_index.htm">Приложения</a></p>
<div class="level"><p><a href="app_index.htm#light_htm:app_a">Приложение А. Функции, константы и структуры RDS</a></p>
<div class="level"><p><a href="app_index.htm#light_htm:app_a_5">А.5. Сервисные функции RDS</a></p>
<div class="level"><p><a href="app_index.htm#light_htm:app_a_5_14">А.5.14. Общие функции работы с переменными блока</a></p>
<div class="level"><p>А.5.14.3. <span class="cpp">rdsClearRuntimeType</span> &ndash; очистка переменной произвольного типа</p>
</div>
</div>
</div>
</div>
</div>
</div></div>
<div class="topnav"><span class="off"><b>Навигация:</b></span>
<div class="left">
<span class="button"><a href="rdsBlockVarToMem.htm" title="Предыдущий параграф" id="pgup">&lt;&lt;</a></span>
<span class="button"><a href="rdsCopyRuntimeType.htm" title="Следующий параграф" id="pgdn">&gt;&gt;</a></span>
<span class="divider"></span>
<span class="button"><a href="app_index.htm#light_htm:rdsClearRuntimeType">Оглавление</a></span>
<span class="button"><a href="alpha.htm">Указатель</a></span>
</div>
</div>

<div class="text">
<h1 class="off">Приложения</h1>
<h2 class="off">Приложение А. Функции, константы и структуры RDS</h2>
<h3 class="off">А.5. Сервисные функции RDS</h3>
<h4 class="off">А.5.14. Общие функции работы с переменными блока</h4>
<h5>А.5.14.3. <span class="cpp">rdsClearRuntimeType</span> &ndash; очистка переменной произвольного типа</h5>


<p>Функция <span class="cpp">rdsClearRuntimeType</span> очищает переменную
<a href="pm_1_5.htm#light_ref15" title="Произвольный тип переменной блока">произвольного типа</a> с указанным базовым адресом.</p>

<pre class="cpp">  <span class="kw">void</span> <a class="hidden" href="app_ids.htm#light_ref24" title="Тип вызова сервисных функций">RDSCALL</a> rdsClearRuntimeType(
      <a class="hidden" href="app_ids.htm#light_ref21" title="Указатель на любые данные (void*)">LPVOID</a> BaseAddr    <span class="rem">// Базовый адрес переменной</span>
  );</pre>

<p class="apphdr">Тип указателя на эту функцию</p>
<p><span class="cpp">RDS_VpV</span></p>

<p class="apphdr">Параметр</p>

<dl>
  <dt><span class="cpp">BaseAddr</span>&emsp;(<span class="cpp"><i><a href="app_ids.htm#light_ref21" title="Указатель на любые данные (void*)">LPVOID</a></i></span>)</dt>
  <dd>Базовый адрес переменной в дереве, то есть указатель на блок из восьми байтов, которые эта
  переменная занимает в дереве переменных блока (см. <a href="pm_2_5_6.htm" title="&sect;2.5.6. Работа с переменными произвольного типа">&sect;2.5.6 руководства программиста</a>).</dd>
</dl>

<p class="apphdr">Примечания</p>
<p>Вызов этой функции присваивает указанной переменной пустой фактический тип.</p>

<p class="apphdr">Пример</p>
<p>Модель блока-переключателя (мультиплексора), который подает на выход &laquo;<span class="rdsvar">y</span>&raquo; произвольного
типа элемент входного массива переменных произвольного типа &laquo;<span class="rdsvar">X</span>&raquo; с номером, определяемым целым
входом &laquo;<span class="rdsvar">N</span>&raquo;. Если &laquo;<span class="rdsvar">N</span>&raquo; меньше нуля или больше числа элементов в массиве
&laquo;<span class="rdsvar">X</span>&raquo;, выход &laquo;<span class="rdsvar">y</span>&raquo; очищается, то есть ему присваивается пустой фактический тип.</p>

<p>Блок должен иметь следующую структуру переменных:</p>

<div class="tablecenter"><div class="tcont">
<table>

  <tr>
    <th>Смещение</th>
    <th>Имя</th>
    <th>Тип</th>
    <th>Размер</th>
    <th>Вход/выход</th>
    <th>Пуск</th>
    <th>Начальное значение</th>
  </tr><tr><td class="center">0</td>
<td class="vcenter">Start</td>
<td class="center">Сигнал</td>
<td class="center">1</td>
<td class="center">Вход</td>
<td class="center">&checkmark;</td>
<td class="center">0</td>
</tr>
<tr><td class="center">1</td>
<td class="vcenter">Ready</td>
<td class="center">Сигнал</td>
<td class="center">1</td>
<td class="center">Выход</td>
<td></td>
<td class="center">0</td>
</tr>
<tr><td class="center">2</td>
<td class="vcenter">X</td>
<td class="center">Массив произвольных</td>
<td class="center">8</td>
<td class="center">Вход</td>
<td class="center">&checkmark;</td>
<td class="center"></td>
</tr>
<tr><td class="center">10</td>
<td class="vcenter">N</td>
<td class="center">int</td>
<td class="center">4</td>
<td class="center">Вход</td>
<td class="center">&checkmark;</td>
<td class="center">0</td>
</tr>
<tr><td class="center">14</td>
<td class="vcenter">y</td>
<td class="center">Произвольный</td>
<td class="center">8</td>
<td class="center">Выход</td>
<td></td>
<td class="center"></td>
</tr>


</table>
</div></div>

<p>Модель блока:</p>

<pre class="cpp">  <span class="kw">extern</span> <span class="str">"C"</span> <span class="kw">__declspec</span>(<span class="kw">dllexport</span>) <span class="kw">int</span> <a class="hidden" href="app_ids.htm#light_ref24" title="Тип вызова сервисных функций">RDSCALL</a> MultiplexMVariant(
      <span class="kw">int</span> CallMode,<a class="hidden" href="RDS_BLOCKDATA.htm#ref2" title="Указатель на RDS_BLOCKDATA">RDS_PBLOCKDATA</a> BlockData,<a class="hidden" href="app_ids.htm#light_ref21" title="Указатель на любые данные (void*)">LPVOID</a> ExtParam)
  <span class="rem">// </span><a class="hidden" href="pm_2_5_1.htm#light_ref9" title="Макросы для статических переменных блока"><span class="rem">Макросы для переменных</span></a>
  <span class="preproc">#define pStart ((char *)(BlockData->VarData))</span>
  <span class="preproc">#define pReady ((char *)(pStart+1))</span>
  <span class="preproc">#define pX ((void **)(pStart+2))</span>
  <span class="preproc">#define pN ((int *)(pStart+10))</span>
  <span class="preproc">#define py ((void **)(pStart+14))</span>
  {
    <span class="kw">switch</span>(CallMode)
      { <span class="kw">case</span> <a class="hidden" href="RDS_BFM_VARCHECK.htm" title="А.2.4.18. RDS_BFM_VARCHECK &ndash; проверка допустимости структуры статических переменных блока">RDS_BFM_VARCHECK</a>:
          <span class="kw">if</span>(strcmp((<span class="kw">char</span>*)ExtParam,<span class="str">"{SSMVIV}"</span>)==<span class="const">0</span>)
            <span class="kw">return</span> RDS_BFR_DONE;
          <span class="kw">return</span> RDS_BFR_BADVARSMSG;

        <span class="kw">case</span> <a class="hidden" href="RDS_BFM_MODEL.htm" title="А.2.4.9. RDS_BFM_MODEL &ndash; выполнение такта расчета">RDS_BFM_MODEL</a>:
          <span class="kw">if</span>(<a class="hidden" href="RDS_ARRAYEXISTS.htm" title="А.5.15.3. Макрос RDS_ARRAYEXISTS &ndash; проверка наличия элементов в матрице/массиве">RDS_ARRAYEXISTS</a>(pX)) <span class="rem">// Массив X не пустой</span>
            { <span class="kw">int</span> n=<a class="hidden" href="RDS_ARRAYROWS.htm" title="А.5.15.6. Макрос RDS_ARRAYROWS &ndash; число строк матрицы/массива">RDS_ARRAYROWS</a>(pX)*<a class="hidden" href="RDS_ARRAYCOLS.htm" title="А.5.15.1. Макрос RDS_ARRAYCOLS &ndash; число столбцов матрицы/массива">RDS_ARRAYCOLS</a>(pX),N=*pN;
              BYTE *data=(BYTE*)<a class="hidden" href="RDS_ARRAYDATA.htm" title="А.5.15.2. Макрос RDS_ARRAYDATA &ndash; указатель на первый элемент матрицы/массива">RDS_ARRAYDATA</a>(pX); <span class="rem">// 1-й элемент</span>
              <span class="kw">if</span>(N&gt;=<span class="const">0</span> && N&lt;n) <span class="rem">// Копируем в выход</span>
                <a class="hidden" href="rdsCopyRuntimeType.htm" title="А.5.14.4. rdsCopyRuntimeType &ndash; копировать переменную произвольного типа">rdsCopyRuntimeType</a>(py,data+N*<span class="const">2</span>*<span class="kw">sizeof</span>(<span class="kw">void</span>*));
              <span class="kw">else</span>
                rdsClearRuntimeType(py); <span class="rem">// Очищаем выход</span>
            }
          <span class="kw">else</span> <span class="rem">// Нет массива X</span>
            rdsClearRuntimeType(py); <span class="rem">// Очищаем выход</span>
          <span class="kw">break</span>;
      }
    <span class="kw">return</span> RDS_BFR_DONE;
  }
  <span class="preproc">#undef py</span>
  <span class="preproc">#undef pN</span>
  <span class="preproc">#undef pX</span>
  <span class="preproc">#undef pReady</span>
  <span class="preproc">#undef pStart</span>
  <span class="rem">//=========================================</span></pre>

<p class="apphdr">См. также</p>
<p class="seealso"><span class="cpp"><a href="rdsCopyRuntimeType.htm" title="А.5.14.4. rdsCopyRuntimeType &ndash; копировать переменную произвольного типа">rdsCopyRuntimeType</a></span>,
<span class="cpp"><a href="rdsSetRuntimeType.htm" title="А.5.14.19. rdsSetRuntimeType &ndash; установить фактический тип переменной произвольного типа">rdsSetRuntimeType</a></span>,
<span class="cpp"><a href="rdsGetBlockVarBase.htm" title="А.5.14.11. rdsGetBlockVarBase &ndash; базовый адрес переменной блока по ее номеру">rdsGetBlockVarBase</a></span>.</p>

</div>
<p style="clear:both; min-height:1em; padding:0px; margin: 0px;"></p><hr class="off" /><div class="bottomnav">
<div class="left">
<span class="button"><a href="rdsBlockVarToMem.htm" title="Предыдущий параграф" id="pgup_f">&lt;&lt;</a></span>
<span class="button"><a href="rdsCopyRuntimeType.htm" title="Следующий параграф" id="pgdn_f">&gt;&gt;</a></span>
<span class="divider"></span>
<span class="button"><a href="app_index.htm#light_htm:rdsClearRuntimeType">Оглавление</a></span>
<span class="button"><a href="alpha.htm">Указатель</a></span>
</div>
</div>
</body>
</html>
