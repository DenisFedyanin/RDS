<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru" xml:lang="ru">
<head>
  <link rel="stylesheet" type="text/css" href="../css/main.css" />
  <link rel="stylesheet" type="text/css" href="../css/cpp.css" />
  <meta http-equiv="Content-Type" content="text/html;charset=windows-1251" />
  <script type="text/javascript" src="script.js"></script>
  <title>А.5.13.10. rdsQueueCallBlockFunction &ndash; отложенный вызов функции блока</title>
</head><body onload="DocLoad()">
<div class="pageheader"><span class="off"><b>Текущий раздел:</b></span>
<div class="int"><p id="top"><a href="../index.htm">Описания RDS</a></p>
<div class="level"><p><a href="app_index.htm">Приложения</a></p>
<div class="level"><p><a href="app_index.htm#light_htm:app_a">Приложение А. Функции, константы и структуры RDS</a></p>
<div class="level"><p><a href="app_index.htm#light_htm:app_a_5">А.5. Сервисные функции RDS</a></p>
<div class="level"><p><a href="app_index.htm#light_htm:app_a_5_13">А.5.13. Вызов функций блоков</a></p>
<div class="level"><p>А.5.13.10. <span class="cpp">rdsQueueCallBlockFunction</span> &ndash; отложенный вызов функции блока</p>
</div>
</div>
</div>
</div>
</div>
</div></div>
<div class="topnav"><span class="off"><b>Навигация:</b></span>
<div class="left">
<span class="button"><a href="rdsCheckBlockFunctionSupport.htm" title="Предыдущий параграф" id="pgup">&lt;&lt;</a></span>
<span class="button"><a href="rdsRegisterFuncProvider.htm" title="Следующий параграф" id="pgdn">&gt;&gt;</a></span>
<span class="divider"></span>
<span class="button"><a href="app_index.htm#light_htm:rdsQueueCallBlockFunction">Оглавление</a></span>
<span class="button"><a href="alpha.htm">Указатель</a></span>
</div>
</div>

<div class="text">
<h1 class="off">Приложения</h1>
<h2 class="off">Приложение А. Функции, константы и структуры RDS</h2>
<h3 class="off">А.5. Сервисные функции RDS</h3>
<h4 class="off">А.5.13. Вызов функций блоков</h4>
<h5>А.5.13.10. <span class="cpp">rdsQueueCallBlockFunction</span> &ndash; отложенный вызов функции блока</h5>


<p>Функция <span class="cpp">rdsQueueCallBlockFunction</span> ставит указанную функцию указанного блока в
очередь на выполнение. После этого управление немедленно возвращается модели вызвавшего функцию блока,
а поставленная в очередь функция будет вызвана только после завершения этой модели.</p>

<pre class="cpp">  <span class="kw">void</span> <a class="hidden" href="app_ids.htm#light_ref24" title="Тип вызова сервисных функций">RDSCALL</a> rdsQueueCallBlockFunction(
      <a class="hidden" href="app_ids.htm#light_ref1" title="Идентификатор блока">RDS_BHANDLE</a> Block,     <span class="rem">// Вызываемый блок</span>
      <span class="kw">int</span> FuncId,            <span class="rem">// Идентификатор функции</span>
      <a class="hidden" href="app_ids.htm#light_ref21" title="Указатель на любые данные (void*)">LPVOID</a> pParamBuf,      <span class="rem">// Указатель на область параметров функции</span>
      <a class="hidden" href="app_ids.htm#light_ref14" title="Беззнаковое целое 32 бита">DWORD</a> ParamBufSize,    <span class="rem">// Размер области параметров</span>
      <a class="hidden" href="app_ids.htm#light_ref14" title="Беззнаковое целое 32 бита">DWORD</a> Flags            <span class="rem">// Флаги (RDS_BCALL_*)</span>
  );</pre>

<p class="apphdr">Тип указателя на эту функцию</p>
<p><span class="cpp">RDS_VBhIpVDwDw</span></p>

<p class="apphdr">Параметры</p>

<dl>
  <dt><span class="cpp">Block</span>&emsp;(<span class="cpp"><i><a href="app_ids.htm#light_ref1" title="Идентификатор блока">RDS_BHANDLE</a></i></span>)</dt>
  <dd>Идентификатор блока, функция которого будет вызвана (модель этого блока будет реагировать на событие
  <span class="cpp"><a href="RDS_BFM_FUNCTIONCALL.htm" title="А.2.4.6. RDS_BFM_FUNCTIONCALL &ndash; вызов функции блока">RDS_BFM_FUNCTIONCALL</a></span>).</dd>

  <dt><span class="cpp">FuncId</span>&emsp;(<span class="cpp"><i>int</i></span>)</dt>
  <dd>Целый идентификатор вызываемой функции, полученный при ее регистрации вызовом
  <span class="cpp"><a href="rdsRegisterFunction.htm" title="А.5.13.12. rdsRegisterFunction &ndash; регистрация функции блока">rdsRegisterFunction</a></span>.</dd>

  <dt><span class="cpp">pParamBuf</span>&emsp;(<span class="cpp"><i><a href="app_ids.htm#light_ref21" title="Указатель на любые данные (void*)">LPVOID</a></i></span>)</dt>
  <dd>Указатель на область параметров функции, которая будет скопирована во внутреннюю память RDS. Область
  параметров не должна содержать внутри себя какие-либо указатели на другие области памяти и объекты. Может
  равняться <span class="cpp">NULL</span>.</dd>

  <dt><span class="cpp">ParamBufSize</span>&emsp;(<span class="cpp"><i><a href="app_ids.htm#light_ref14" title="Беззнаковое целое 32 бита">DWORD</a></i></span>)</dt>
  <dd>Размер (в байтах) области параметров, указатель на которую передан в <span class="cpp">pParams</span>.</dd>

  <dt><span class="cpp">vv</span>&emsp;(<span class="cpp"><i>DWORD</i></span>)</dt>
  <dd>Один или несколько объединенных битовым ИЛИ флагов, управляющих вызовом функции:<br />
    <div class="tableleft"><div class="tcont">
      <table class="list">
        <tr>
          <td class="term"><span class="cpp"><span id="light_ref1">RDS_BCALL_CHECKSUPPORT</span></span></td>
          <td>Перед вызовом проверить поддержку этой функции блоком, вызвав его модель для реакции на событие
          <span class="cpp"><a href="RDS_BFM_CHECKFUNCSUPPORT.htm" title="А.2.4.2. RDS_BFM_CHECKFUNCSUPPORT &ndash; проверка поддержки блоком функции с заданным идентификатором">RDS_BFM_CHECKFUNCSUPPORT</a></span>. В настоящее время этот режим практически не используется.</td>
        </tr>
        <tr>
          <td class="term"><span class="cpp"><span id="light_ref2">RDS_BCALL_FIRST</span></span></td>
          <td>Поставить вызов функции блока в начало очереди (не может использоваться одновременно с
          <span class="cpp">RDS_BCALL_LAST</span>).</td>
        </tr>
        <tr>
          <td class="term"><span class="cpp"><span id="light_ref3">RDS_BCALL_LAST</span></span></td>
          <td>Поставить вызов функции блока в конец очереди (не может использоваться одновременно с
          <span class="cpp">RDS_BCALL_FIRST</span>).</td>
        </tr>
      </table>
    </div></div>
  </dd>
</dl>

<p class="apphdr">Примечания</p>
<p>Вызов этой функции приводит к постановке вызова модели блока <span class="cpp">Block</span> для реакции на
событие <span class="cpp"><a href="RDS_BFM_FUNCTIONCALL.htm" title="А.2.4.6. RDS_BFM_FUNCTIONCALL &ndash; вызов функции блока">RDS_BFM_FUNCTIONCALL</a></span> в начало или конец (в зависимости от флагов) специальной очереди.
Вызовы функций из этой очереди будут выполнены последовательно после завершения модели вызвавшего функцию блока.
Когда модель блока <span class="cpp">Block</span> будет вызвана в режиме
<span class="cpp">RDS_BFM_FUNCTIONCALL</span>, поля структуры данных функции
<span class="cpp"><a href="RDS_BFM_FUNCTIONCALL.htm#ref1" title="Структура RDS_FUNCTIONCALLDATA">RDS_FUNCTIONCALLDATA</a></span>, указатель на которую передается в модель блока в параметре
<span class="cpp">ExtParam</span>, будут заполнены следующим образом:</p>

<div class="tablecenter"><div class="tcont">
<table>
  <tr>
    <th>Поле</th>
    <th>Значение</th>
  </tr>
  <tr>
    <td><span class="cpp"><span class="kw">int</span> Function</span></td>
    <td>значение параметра <span class="cpp">FuncId</span></td>
  </tr>
  <tr>
    <td><span class="cpp"><a class="hidden" href="app_ids.htm#light_ref21" title="Указатель на любые данные (void*)">LPVOID</a> Data</span></td>
    <td>указатель на внутреннюю область памяти RDS размером в <span class="cpp">ParamBufSize</span> байтов,
    в которую скопирована область <span class="cpp">pParamBuf</span></td>
  </tr>
  <tr>
    <td><span class="cpp"><a class="hidden" href="app_ids.htm#light_ref1" title="Идентификатор блока">RDS_BHANDLE</a> Caller</span></td>
    <td>идентификатор блока, из модели которого вызвана <span class="cpp">rdsCallBlockFunctionDelayed</span></td>
  </tr>
  <tr>
    <td><span class="cpp"><a class="hidden" href="app_ids.htm#light_ref11" title="Логический тип Windows API">BOOL</a> Broadcast</span></td>
    <td><span class="cpp">FALSE</span></td>
  </tr>
  <tr>
    <td><span class="cpp"><span class="kw">int</span> BroadcastCnt</span></td>
    <td>0</td>
  </tr>
  <tr>
    <td><span class="cpp"><a class="hidden" href="app_ids.htm#light_ref11" title="Логический тип Windows API">BOOL</a> Stop</span></td>
    <td><span class="cpp">FALSE</span></td>
  </tr>
  <tr>
    <td><span class="cpp"><a class="hidden" href="app_ids.htm#light_ref11" title="Логический тип Windows API">BOOL</a> Delayed</span></td>
    <td><span class="cpp">TRUE</span></td>
  </tr>
  <tr>
    <td><span class="cpp"><a class="hidden" href="app_ids.htm#light_ref14" title="Беззнаковое целое 32 бита">DWORD</a> DataBufSize</span></td>
    <td>значение параметра <span class="cpp">ParamBufSize</span></span></td>
  </tr>
</table>
</div></div>

<p>В отличие от прямого вызова функции блока, при отложенном вызове модели вызванного блока передается
не указатель на область параметров функции, а указатель на копию этой области, сделанную RDS (именно поэтому
при отложенном вызове всегда указывается размер области параметров и требуется, чтобы эта область не содержала
указателей). Поскольку вызов функции будет выполнен уже после завершения модели вызвавшего блока, оригинальная
область параметров на момент вызова может быть уже уничтожена, но сделанная RDS копия останется в памяти
до фактического вызова функции блока.</p>

<p class="apphdr">Пример</p>
<p>Пример использования функции <span class="cpp">rdsQueueCallBlockFunction</span> приведен
в <a href="pm_2_13_5.htm" title="&sect;2.13.5. Отложенный вызов функций блоков">&sect;2.13.5 руководства программиста</a>.</p>

<p class="apphdr">См. также</p>
<p class="seealso"><span class="cpp"><a href="RDS_BFM_FUNCTIONCALL.htm" title="А.2.4.6. RDS_BFM_FUNCTIONCALL &ndash; вызов функции блока">RDS_BFM_FUNCTIONCALL</a></span>,
<span class="cpp"><a href="RDS_BFM_FUNCTIONCALL.htm#ref1" title="Структура RDS_FUNCTIONCALLDATA">RDS_FUNCTIONCALLDATA</a></span>,
<span class="cpp"><a href="rdsCallBlockFunction.htm" title="А.5.13.7. rdsCallBlockFunction &ndash; прямой вызов функции блока">rdsCallBlockFunction</a></span>,
<span class="cpp"><a href="rdsCallBlockFunctionDelayed.htm" title="А.5.13.8. rdsCallBlockFunctionDelayed &ndash; отложенный вызов функции блока (устаревшая)">rdsCallBlockFunctionDelayed</a></span>,
<span class="cpp"><a href="rdsBroadcastFunctionCallsEx.htm" title="А.5.13.6. rdsBroadcastFunctionCallsEx &ndash; прямой вызов функции всех блоков подсистемы">rdsBroadcastFunctionCallsEx</a></span>,
<span class="cpp"><a href="rdsRegisterFunction.htm" title="А.5.13.12. rdsRegisterFunction &ndash; регистрация функции блока">rdsRegisterFunction</a></span>.</p>

</div>
<p style="clear:both; min-height:1em; padding:0px; margin: 0px;"></p><hr class="off" /><div class="bottomnav">
<div class="left">
<span class="button"><a href="rdsCheckBlockFunctionSupport.htm" title="Предыдущий параграф" id="pgup_f">&lt;&lt;</a></span>
<span class="button"><a href="rdsRegisterFuncProvider.htm" title="Следующий параграф" id="pgdn_f">&gt;&gt;</a></span>
<span class="divider"></span>
<span class="button"><a href="app_index.htm#light_htm:rdsQueueCallBlockFunction">Оглавление</a></span>
<span class="button"><a href="alpha.htm">Указатель</a></span>
</div>
</div>
</body>
</html>
