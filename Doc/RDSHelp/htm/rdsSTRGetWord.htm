<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru" xml:lang="ru">
<head>
  <link rel="stylesheet" type="text/css" href="../css/main.css" />
  <link rel="stylesheet" type="text/css" href="../css/cpp.css" />
  <meta http-equiv="Content-Type" content="text/html;charset=windows-1251" />
  <script type="text/javascript" src="script.js"></script>
  <title>А.5.26.4. rdsSTRGetWord &ndash; считать из текста очередное слово</title>
</head><body onload="DocLoad()">
<div class="pageheader"><span class="off"><b>Текущий раздел:</b></span>
<div class="int"><p id="top"><a href="../index.htm">Описания RDS</a></p>
<div class="level"><p><a href="app_index.htm">Приложения</a></p>
<div class="level"><p><a href="app_index.htm#light_htm:app_a">Приложение А. Функции, константы и структуры RDS</a></p>
<div class="level"><p><a href="app_index.htm#light_htm:app_a_5">А.5. Сервисные функции RDS</a></p>
<div class="level"><p><a href="app_index.htm#light_htm:app_a_5_26">А.5.26. Вспомогательный объект для разбора текста</a></p>
<div class="level"><p>А.5.26.4. <span class="cpp">rdsSTRGetWord</span> &ndash; считать из текста очередное слово</p>
</div>
</div>
</div>
</div>
</div>
</div></div>
<div class="topnav"><span class="off"><b>Навигация:</b></span>
<div class="left">
<span class="button"><a href="rdsSTRAddKeywordsArray.htm" title="Предыдущий параграф" id="pgup">&lt;&lt;</a></span>
<span class="button"><a href="RDS_HSTR_ENDOFLINEID.htm" title="Следующий параграф" id="pgdn">&gt;&gt;</a></span>
<span class="divider"></span>
<span class="button"><a href="app_index.htm#light_htm:rdsSTRGetWord">Оглавление</a></span>
<span class="button"><a href="alpha.htm">Указатель</a></span>
</div>
</div>

<div class="text">
<h1 class="off">Приложения</h1>
<h2 class="off">Приложение А. Функции, константы и структуры RDS</h2>
<h3 class="off">А.5. Сервисные функции RDS</h3>
<h4 class="off">А.5.26. Вспомогательный объект для разбора текста</h4>
<h5>А.5.26.4. <span class="cpp">rdsSTRGetWord</span> &ndash; считать из текста очередное слово</h5>


<p>Функция <span class="cpp">rdsSTRGetWord</span> считывает очередное слово из текста, переданного в
<a href="rdsSTRCreateTextReader.htm" title="А.5.26.1. rdsSTRCreateTextReader &ndash; создать объект для разбора текста">объект</a>
командой <span class="cpp"><a href="RDS_HSTR_SETTEXT.htm" title="А.5.26.12. Команда RDS_HSTR_SETTEXT &ndash; передать в объект текст для разбора">RDS_HSTR_SETTEXT</a></span>, и возвращает указатель на это слово, указатель
на следующую за словом часть текста, а также идентификатор этого слова, если оно совпало с одним из ключевых.</p>

<pre class="cpp">  <span class="kw">int</span> <a class="hidden" href="app_ids.htm#light_ref24" title="Тип вызова сервисных функций">RDSCALL</a> rdsSTRGetWord(
    <a class="hidden" href="app_ids.htm#light_ref6" title="Идентификатор вспомогательного объекта">RDS_HOBJECT</a> Parser,    <span class="rem">// Объект</span>
    <a class="hidden" href="app_ids.htm#light_ref20" title="Указатель на строку (char*)">LPSTR</a> *pWord,          <span class="rem">// Возвращаемый указатель на слово</span>
    <a class="hidden" href="app_ids.htm#light_ref20" title="Указатель на строку (char*)">LPSTR</a> *pNext,          <span class="rem">// Возвращаемый остаток текста</span>
    <span class="kw">char</span> *pWordType,       <span class="rem">// Возвращаемый тип слова</span>
    <a class="hidden" href="app_ids.htm#light_ref11" title="Логический тип Windows API">BOOL</a> Analyse           <span class="rem">// Сравнивать с ключевыми</span>
  );</pre>

<p class="apphdr">Тип указателя на эту функцию</p>
<p><span class="cpp">RDS_IHopSpSpCB</span></p>

<p class="apphdr">Параметры</p>

<dl>
  <dt><span class="cpp">Parser</span>&emsp;(<span class="cpp"><i><a href="app_ids.htm#light_ref6" title="Идентификатор вспомогательного объекта">RDS_HOBJECT</a></i></span>)</dt>
  <dd>Идентификатор вспомогательного объекта для разбора текста, ранее созданного функцией
  <span class="cpp"><a href="rdsSTRCreateTextReader.htm" title="А.5.26.1. rdsSTRCreateTextReader &ndash; создать объект для разбора текста">rdsSTRCreateTextReader</a></span>.</dd>

  <dt><span class="cpp">pWord</span>&emsp;(<span class="cpp"><i><a href="app_ids.htm#light_ref20" title="Указатель на строку (char*)">LPSTR</a>*</i></span>)</dt>
  <dd>Указатель типа <span class="cpp">char**</span> на переменную, в которую будет записан указатель
  на извлеченное из текста слово, находящееся во внутренней памяти объекта <span class="cpp">Parser</span>.
  Если вызывающей программе не нужно это слово, в этом параметре можно передать <span class="cpp">NULL</span>.</dd>

  <dt><span class="cpp">pNext</span>&emsp;(<span class="cpp"><i>LPSTR*</i></span>)</dt>
  <dd>Указатель типа <span class="cpp">char**</span> на переменную, в которую будет записан указатель на
  следующую за извлеченным словом часть текста. Допускается обработать часть этого текста вручную,
  после чего снова передать объекту продолжение текста командой
  <span class="cpp">RDS_HSTR_SETTEXT</span> (см. пример ниже). Если вызывающей программе не нужен указатель
  на продолжение текста, в этом параметре можно передать <span class="cpp">NULL</span>.</dd>

  <dt><span class="cpp">pWordType</span>&emsp;(<span class="cpp"><i>char*</i></span>)</dt>
  <dd>Указатель на переменную типа <span class="cpp">char</span>, в которую будет записан вид считанного
  слова (аналогично параметру <span class="cpp">pSym</span> функции <span class="cpp"><a href="rdsGetTextWord.htm" title="А.5.11.2. rdsGetTextWord &ndash; извлечение слова из текста">rdsGetTextWord</a></span>).
  Если вызывающей программе не нужен вид слова, в этом параметре можно передать <span class="cpp">NULL</span>.
  От вида слова зависит его предварительная обработка внутри функции, от него также может зависеть реакция на
  это слово вызвавшей функцию программы. По указателю <span class="cpp">pWordType</span> может быть
  записан один из следующих символов:<br />
  <div class="tablecenter"><div class="tcont">
  <table>
    <tr>
      <th><span class="cpp">*pWordType</span>&nbsp;(код)</th>
      <th>Значение</th>
    </tr>
    <tr>
      <td><span id="ref1">0</span></td>
      <td>Считан конец текста, в нем больше нет слов. Функция при этом вернет специальный идентификатор
      конца текста (по умолчанию &ndash; константу <span id="light_ref1" class="cpp">RDS_HSTR_DEFENDOFTEXT</span>).</td>
    </tr>
    <tr>
      <td><span id="ref2">10</span>
      (&laquo;\n&raquo;)</td>
      <td>Считан конец строки, следующее слово находится на следующей строке. Извлеченное функцией слово
      (<span class="cpp">*pWord</span>) при этом будет состоять из единственного символа &laquo;\n&raquo;,
      а результатом возврата функции будет специальный идентификатор конца строки (по умолчанию &ndash;
      <span id="light_ref2" class="cpp">RDS_HSTR_DEFENDOFLINE</span>).</td>
    </tr>
    <tr>
      <td>Двойная кавычка (&laquo;\"&raquo;)</td>
      <td>Считанное слово на самом деле является строкой в двойных кавычках (возможно, с пробелами), в которой
      непечатаемые символы заменены на их <a href="rdsProcessText.htm#ref5" title="Преобразование текста в хранимую строку">символические обозначения</a>.
      Через параметр <span class="cpp">pWord</span> при этом функция вернет строку без кавычек, в которой символические
      обозначения заменены на сами символы, в т.ч. и непечатаемые.</td>
    </tr>
    <tr>
      <td>Другие коды</td>
      <td>Считано слово, состоящее из слитно набранных печатаемых символов. В <span class="cpp">*pWordType</span>
      будет записан первый символ этого слова, а через параметр <span class="cpp">pWord</span> функция
      вернет само слово.</td>
    </tr>
  </table>
  </div></div>
  </dd>

  <dt><span class="cpp">Analyse</span>&emsp;(<span class="cpp"><i><a href="app_ids.htm#light_ref11" title="Логический тип Windows API">BOOL</a></i></span>)</dt>
  <dd><span class="cpp">TRUE</span> &ndash; сравнивать слова, извлекаемые из текста, с ключевыми словами,
  записанными в объект функциями <span class="cpp"><a href="rdsSTRAddKeyword.htm" title="А.5.26.2. rdsSTRAddKeyword &ndash; добавление ключевого слова">rdsSTRAddKeyword</a></span> и <span class="cpp"><a href="rdsSTRAddKeywordsArray.htm" title="А.5.26.3. rdsSTRAddKeywordsArray &ndash; добавление набора ключевых слов">rdsSTRAddKeywordsArray</a></span>.
  <span class="cpp">FALSE</span> &ndash; не сравнивать слова с ключевыми.</dd>
</dl>

<p class="apphdr">Возвращаемое значение</p>
<p>Если в параметре <span class="cpp">Analyse</span> передано <span class="cpp">TRUE</span> и извлеченное
из текста слово совпало с одним из ключевых слов объекта, функция вернет идентификатор этого ключевого слова.
В противном случае результат функции будет следующим:</p>

<ul>
  <li>Если достигнут конец текста (завершающий нулевой байт), функция вернет специальный идентификатор конца текста.
  По умолчанию это константа <span class="cpp">RDS_HSTR_DEFENDOFTEXT</span>, но этот идентификатор может быть,
  при необходимости, изменен командой <span class="cpp"><a href="RDS_HSTR_ENDOFTEXTID.htm" title="А.5.26.6. Команда RDS_HSTR_ENDOFTEXTID &ndash; идентификатор конца текста">RDS_HSTR_ENDOFTEXTID</a></span>.</li>

  <li>Если достигнут конец строки (символ перевода строки, байт с кодом 10), функция вернет специальный идентификатор
  конца строки. По умолчанию это константа <span class="cpp">RDS_HSTR_DEFENDOFLINE</span>, но этот идентификатор может
  быть, при необходимости, изменен командой <span class="cpp"><a href="RDS_HSTR_ENDOFLINEID.htm" title="А.5.26.5. Команда RDS_HSTR_ENDOFLINEID &ndash; идентификатор конца строки">RDS_HSTR_ENDOFLINEID</a></span>.</li>

  <li><span id="ref3">Если</span>
  сравнение с ключевыми словами не разрешено (<span class="cpp">Analyse==FALSE</span>) или извлеченное слово
  не совпало ни с одним из ключевых, функция вернет специальный идентификатор неизвестного слова. По умолчанию это
  константа <span id="light_ref3" class="cpp">RDS_HSTR_DEFUNKNOWNWORD</span>, но этот идентификатор может
  быть, при необходимости, изменен командой <span class="cpp"><a href="RDS_HSTR_UNKNOWNID.htm" title="А.5.26.13. Команда RDS_HSTR_UNKNOWNID &ndash; идентификатор неопознанного слова">RDS_HSTR_UNKNOWNID</a></span>.</li>
</ul>

<p class="apphdr">Примечания</p>
<p>Эта функция во многом похожа на функцию <span class="cpp"><a href="rdsGetTextWord.htm" title="А.5.11.2. rdsGetTextWord &ndash; извлечение слова из текста">rdsGetTextWord</a></span>, поэтому их параметры частично
совпадают. Однако, в отличие от <span class="cpp">rdsGetTextWord</span>, функция <span class="cpp">rdsSTRGetWord</span>
не только извлекает из текста слово, ограниченное пробелами или заключенное в кавычки, но и сравнивает его
(если это разрешено параметром <span class="cpp">Analyse</span>) с набором ключевых слов объекта.
Это упрощает анализ извлеченного слова в вызвавшей программе.</p>

<p>Словом текста, как и в функции <span class="cpp">rdsGetTextWord</span>, считается либо последовательность
любых печатаемых символов, либо строка в двойных кавычках. Разделителями слов считаются пробелы и
табуляции. Код перевода строки &laquo;\n&raquo; считается отдельным словом из одного символа.
Нулевой байт, завершающий текст, тоже считается отдельным словом (пустой строкой).</p>

<p>Функция отдельно обрабатывает знак продолжения &laquo;+&raquo;, используемый в текстовом формате схем RDS.
Обнаружив его, она пропускает следующий за ним перевод строки и повторение знака продолжения, считая следующую
строку текста продолжением текущей строки и не возвращая отдельно слово конца строки &laquo;\n&raquo;.
Таким образом, например, текст</p>

<pre class="cpp">  word1 word2 +
  + word3 <span class="str">"word 4"</span></pre>

<p class="noindent">будет считаться одной строкой, состоящей из четырех слов: &laquo;word1&raquo;,
&laquo;word2&raquo;, &laquo;word3&raquo; и &laquo;word&nbsp;4&raquo;.</p>

<p>Строка в кавычках считается одним словом, какой бы длинной она ни была и сколько бы пробелов внутри ни
содержала. В приведенном выше примере &laquo;word&nbsp;4&raquo; будет считано функцией как одно слово,
а не как два. Длинные строки тоже могут быть разбиты с помощью символов продолжения &laquo;+&raquo;,
при этом функция автоматически соберет их вместе. Например, текст</p>

<pre class="cpp">  word5 <span class="str">"abcd"</span>+
  +<span class="str">"efgh"</span> word6</pre>

<p class="noindent">будет разобран на три слова: &laquo;word5&raquo;, &laquo;abcdefgh&raquo; и
&laquo;word6&raquo;.</p>

<p>Работу функции <span class="cpp">rdsSTRGetWord</span> можно комбинировать с
<a href="app_index.htm#light_htm:app_a_5_11" title="А.5.11. Разбор текста">общими функциями разбора текста</a>, для этого можно использовать
параметр <span class="cpp">pNext</span>, через который возвращается указатель на следующий за извлеченным
словом участок текста. Рассмотрим, например, следующий фрагмент программы:</p>

<pre class="cpp">  <span class="rem">// Создание объекта</span>
  <a class="hidden" href="app_ids.htm#light_ref6" title="Идентификатор вспомогательного объекта">RDS_HOBJECT</a> obj=<a class="hidden" href="rdsSTRCreateTextReader.htm" title="А.5.26.1. rdsSTRCreateTextReader &ndash; создать объект для разбора текста">rdsSTRCreateTextReader</a>(TRUE);
  <span class="rem">// Занесение ключевых слов</span>
  <a class="hidden" href="rdsSTRAddKeyword.htm" title="А.5.26.2. rdsSTRAddKeyword &ndash; добавление ключевого слова">rdsSTRAddKeyword</a>(obj,<span class="str">"color"</span>,<span class="const">100</span>);
  <a class="hidden" href="rdsSTRAddKeyword.htm" title="А.5.26.2. rdsSTRAddKeyword &ndash; добавление ключевого слова">rdsSTRAddKeyword</a>(obj,<span class="str">"line"</span>,<span class="const">101</span>);
    &hellip;
  <span class="kw">char</span> text[]=<span class="str">"color rgb 0 0 0 line 1"</span>,*word,*next;
  <a class="hidden" href="app_ids.htm#light_ref13" title="Цвет Windows API">COLORREF</a> col;
  <a class="hidden" href="app_ids.htm#light_ref11" title="Логический тип Windows API">BOOL</a> loop=TRUE;
  <span class="rem">// Установка разбираемого текста</span>
  <a class="hidden" href="rdsSetObjectStr.htm" title="А.5.22.12. rdsSetObjectStr &ndash; установить строку">rdsSetObjectStr</a>(obj,<a class="hidden" href="RDS_HSTR_SETTEXT.htm" title="А.5.26.12. Команда RDS_HSTR_SETTEXT &ndash; передать в объект текст для разбора">RDS_HSTR_SETTEXT</a>,<span class="const">0</span>,text);
  <span class="rem">// Цикл обработки текста</span>
  <span class="kw">while</span>(loop)
    <span class="kw">switch</span>(rdsSTRGetWord(obj,NULL,&next,NULL,TRUE))
      { <span class="kw">case</span> RDS_HSTR_DEFENDOFTEXT: <span class="rem">// Конец текста</span>
          loop=FALSE; <span class="kw">break</span>;
        <span class="kw">case</span> <span class="const">100</span>: <span class="rem">// Опознано слово "color"</span>
          <span class="rem">// Считываем и обрабатываем продолжение строки</span>
          col=<a class="hidden" href="rdsReadColorText.htm" title="А.5.11.4. rdsReadColorText &ndash; разбор описания цвета">rdsReadColorText</a>(next,&word);
          <span class="rem">// Новый текст - со следующего слова</span>
          <a class="hidden" href="rdsSetObjectStr.htm" title="А.5.22.12. rdsSetObjectStr &ndash; установить строку">rdsSetObjectStr</a>(obj,<a class="hidden" href="RDS_HSTR_SETTEXT.htm" title="А.5.26.12. Команда RDS_HSTR_SETTEXT &ndash; передать в объект текст для разбора">RDS_HSTR_SETTEXT</a>,<span class="const">0</span>,word);
          <span class="kw">break</span>;
        &hellip;
      }</pre>

<p>В этом примере в объект <span class="cpp">obj</span> добавлено два ключевых слова:
&laquo;color&raquo; с идентификатором 100 и &laquo;line&raquo; с идентификатором 101. После
передачи в объект указателя на начало разбираемого текста <span class="cpp">text</span> командой
<span class="cpp"><a href="RDS_HSTR_SETTEXT.htm" title="А.5.26.12. Команда RDS_HSTR_SETTEXT &ndash; передать в объект текст для разбора">RDS_HSTR_SETTEXT</a></span>, в цикле <span class="cpp">while(loop)</span> слова считываются из
текста и разбираются в операторе <span class="cpp">switch</span>. Если считано слово
&laquo;color&raquo; (идентификатор 100), следующий за ним фрагмент текста передается в функцию
<span class="cpp"><a href="rdsReadColorText.htm" title="А.5.11.4. rdsReadColorText &ndash; разбор описания цвета">rdsReadColorText</a></span>, которая без участия объекта <span class="cpp">obj</span> разберет фрагмент
&laquo;rgb&nbsp;0&nbsp;0&nbsp;0&raquo;, преобразует его в значение цвета <span class="cpp">col</span>
и запишет в переменную <span class="cpp">word</span> указатель на следующий за этим фрагмент текста, т.е на
&laquo;line&nbsp;1&raquo;. Этот указатель командой <span class="cpp">RDS_HSTR_SETTEXT</span> будет передан
в объект <span class="cpp">obj</span> как новое начало текста, и разбор продолжится.</p>

<p class="apphdr">Пример</p>
<p>Другой пример использования функции <span class="cpp">rdsSTRGetWord</span> приведен в
<a href="pm_2_8_4.htm" title="&sect;2.8.4. Поиск ключевых слов с помощью объекта RDS">&sect;2.8.4 руководства программиста</a>.</p>

<p class="apphdr">См. также</p>
<p class="seealso"><span class="cpp"><a href="rdsSTRCreateTextReader.htm" title="А.5.26.1. rdsSTRCreateTextReader &ndash; создать объект для разбора текста">rdsSTRCreateTextReader</a></span>,
<span class="cpp"><a href="RDS_HSTR_SETTEXT.htm" title="А.5.26.12. Команда RDS_HSTR_SETTEXT &ndash; передать в объект текст для разбора">RDS_HSTR_SETTEXT</a></span>,
<span class="cpp"><a href="RDS_HSTR_ENDOFTEXTID.htm" title="А.5.26.6. Команда RDS_HSTR_ENDOFTEXTID &ndash; идентификатор конца текста">RDS_HSTR_ENDOFTEXTID</a></span>,
<span class="cpp"><a href="RDS_HSTR_ENDOFLINEID.htm" title="А.5.26.5. Команда RDS_HSTR_ENDOFLINEID &ndash; идентификатор конца строки">RDS_HSTR_ENDOFLINEID</a></span>,
<span class="cpp"><a href="RDS_HSTR_UNKNOWNID.htm" title="А.5.26.13. Команда RDS_HSTR_UNKNOWNID &ndash; идентификатор неопознанного слова">RDS_HSTR_UNKNOWNID</a></span>,
<span class="cpp"><a href="rdsSTRAddKeyword.htm" title="А.5.26.2. rdsSTRAddKeyword &ndash; добавление ключевого слова">rdsSTRAddKeyword</a></span>,
<span class="cpp"><a href="rdsSTRAddKeywordsArray.htm" title="А.5.26.3. rdsSTRAddKeywordsArray &ndash; добавление набора ключевых слов">rdsSTRAddKeywordsArray</a></span>.</p>

</div>
<p style="clear:both; min-height:1em; padding:0px; margin: 0px;"></p><hr class="off" /><div class="bottomnav">
<div class="left">
<span class="button"><a href="rdsSTRAddKeywordsArray.htm" title="Предыдущий параграф" id="pgup_f">&lt;&lt;</a></span>
<span class="button"><a href="RDS_HSTR_ENDOFLINEID.htm" title="Следующий параграф" id="pgdn_f">&gt;&gt;</a></span>
<span class="divider"></span>
<span class="button"><a href="app_index.htm#light_htm:rdsSTRGetWord">Оглавление</a></span>
<span class="button"><a href="alpha.htm">Указатель</a></span>
</div>
</div>
</body>
</html>
