<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru" xml:lang="ru">
<head>
  <link rel="stylesheet" type="text/css" href="../css/main.css" />
  <link rel="stylesheet" type="text/css" href="../css/cpp.css" />
  <meta http-equiv="Content-Type" content="text/html;charset=windows-1251" />
  <script type="text/javascript" src="script.js"></script>
  <title>&sect;2.10.12. Пример создания блока с анимированной картинкой</title>
</head><body onload="DocLoad()">
<div class="pageheader"><span class="off"><b>Текущий раздел:</b></span>
<div class="int"><p id="top"><a href="../index.htm">Описания RDS</a></p>
<div class="level"><p><a href="um_index.htm">Описание пользователя</a></p>
<div class="level"><p><a href="um_index.htm#light_htm:um_2">Глава 2. Интерфейс пользователя</a></p>
<div class="level"><p><a href="um_index.htm#light_htm:um_2_10">&sect;2.10. Редактирование векторной картинки блока</a></p>
<div class="level"><p>&sect;2.10.12. Пример создания блока с анимированной картинкой</p>
</div>
</div>
</div>
</div>
</div></div>
<div class="topnav"><span class="off"><b>Навигация:</b></span>
<div class="left">
<span class="button"><a href="um_2_10_11.htm" title="Предыдущий параграф" id="pgup">&lt;&lt;</a></span>
<span class="button"><a href="um_2_11_1.htm" title="Следующий параграф" id="pgdn">&gt;&gt;</a></span>
<span class="divider"></span>
<span class="button"><a href="um_index.htm#light_htm:um_2_10_12">Оглавление</a></span>
<span class="button"><a href="alpha.htm">Указатель</a></span>
</div>
</div>

<div class="text">
<h1 class="off">Описание пользователя</h1>
<h2 class="off">Глава 2. Интерфейс пользователя</h2>
<h3 class="off">&sect;2.10. Редактирование векторной картинки блока</h3>
<h4>&sect;2.10.12. Пример создания блока с анимированной картинкой</h4>
<p class="abstract">Рассматривается пример создания векторной картинки блока, изображающей манипулятор с захватом, двигающийся при изменении значений переменных блока.</p>


<div class="picright"><div class="container" id="pic1">
<img src="../img/Manipulator.png" width="517" height="373" alt="Изображаемый манипулятор" />
<p id="light_pic1">Рис.&nbsp;166. Изображаемый манипулятор</p>
</div></div>


<p>Создадим блок, картинка которого будет представлять собой условное изображение
манипулятора
(<a href="#pic1" title="Изображаемый манипулятор">рис.&nbsp;166</a>).
Манипулятор будет иметь три сегмента и захват. Первый сегмент шарнирно закреплен
на неподвижном основании, угол его поворота относительно основания будет
задаваться переменной &alpha;, нулевому значению которой соответствует вертикальное
положение сегмента. Второй сегмент закреплен на конце первого и поворачивается
относительно него на угол &beta;, нулевому значению угла соответствует такое
положение второго сегмента, при котором он повернут вправо от оси первого на угол
90&deg; (см. рисунок). Третий сегмент с захватом закреплен на конце второго,
угол его поворота задается переменной &gamma;, ее нулевое значение соответствует
такому положению сегмента, при котором он повернут вправо от оси второго на
угол 90&deg;. Положительные направления углов отсчитываются против часовой стрелки.
Захват имеет две симметричные губки, положение которых задается переменной C:
полностью разведенным губкам соответствует ее единичное значение, полностью сведенным
&ndash; нулевое. На
<a href="#pic1" title="Изображаемый манипулятор">рис.&nbsp;166</a> изображен предполагаемый внешний
вид манипулятора при &alpha;=&beta;=&gamma;=0, C=1.</p>

<p>Создание блока начнем с создания схемы, в которой он будет находиться.
<span id="ref1">Запустим</span>
RDS (программу
&laquo;<span class="file"><span id="light_ref1">rds.exe</span></span>&raquo;), создадим новую
пустую схему, выбрав пункт меню &laquo;<span class="menu">файл | новый</span>&raquo; и сохраним ее на диск
вызовом пункта меню &laquo;<span class="menu">файл | сохранить</span>&raquo;.
<span id="ref2">В</span> ответ на запрос
RDS дадим новой схеме какое-нибудь имя &ndash; например,
&laquo;<span class="file"><span id="light_ref2">Hand.rds</span></span>&raquo;.</p>

<p>При создании новой схемы автоматически открылось пустое окно ее
<a href="um_1_2.htm#ref11" title="Корневая подсистема">корневой подсистемы</a>
с заголовком &laquo;Система&raquo;. Создадим в этой подсистеме новый блок,
щелкнув правой кнопкой мыши где-нибудь на ее рабочем поле и выбрав в открывшемся
контекстном меню пункт &laquo;<span class="menu">создать | новый блок</span>&raquo;
(<a href="#pic2" title="Создание в подсистеме нового блока (а) и созданный блок (б)">рис.&nbsp;167</a>).
В точке щелчка появится новый блок. У него пока нет картинки, поэтому он
изображается пустым белым квадратом, под которым, если настройки RDS не
изменены, будет выведено его имя: &laquo;<span class="rdsvar">Block1</span>&raquo;. Когда мы добавим к
блоку картинку, отображение имени будет нам мешать, поэтому сразу отключим его,
щелкнув на блоке правой кнопкой мыши и убрав в контекстном меню флажок возле пункта
&laquo;<span class="menu">показывать имя блока</span>&raquo;
(<a href="#pic3" title="Отключение вывода имени блока">рис.&nbsp;168</a>).</p>

<div class="pic"><div class="container" id="pic2">
<div class="multi" id="pic2_0"><img src="../img/PicEditExamp_1_1.png" width="453" height="370" alt="Создание в подсистеме нового блока (а) и созданный блок (б) 1" /><p id="light_pic2_0">(а)</p></div><div class="multi" id="pic2_1"><img src="../img/PicEditExamp_1_2.png" width="134" height="370" alt="Создание в подсистеме нового блока (а) и созданный блок (б) 2" /><p id="light_pic2_1">(б)</p></div><p id="light_pic2">Рис.&nbsp;167. Создание в подсистеме нового блока (а) и созданный блок (б)</p>
</div></div>


<div class="pic"><div class="container" id="pic3">
<img src="../img/PicEditExamp_2.png" width="318" height="366" alt="Отключение вывода имени блока" />
<p id="light_pic3">Рис.&nbsp;168. Отключение вывода имени блока</p>
</div></div>


<p>В этом блоке нам потребуется создать три переменных для углов поворота сегментов
и одну переменную для управления губками захвата. Поскольку наш блок не будет
иметь собственной модели и все управляющие воздействия будут поступать в него
снаружи, эти четыре переменные должны быть входами блока. Согласно
<a href="#pic1" title="Изображаемый манипулятор">рис.&nbsp;166</a> назовем их
&laquo;<span class="rdsvar">Alpha</span>&raquo;, &laquo;<span class="rdsvar">Beta</span>&raquo;, &laquo;<span class="rdsvar">Gamma</span>&raquo; и &laquo;<span class="rdsvar">C</span>&raquo;
и сделаем их вещественными двойной точности, то есть используем тип RDS
&laquo;double&raquo;. Поскольку углы поворота элементов векторной картинки блока,
связанные с переменными, по умолчанию считаются
<a href="um_2_10_8.htm#light_ref4" title="Задание переменной угла поворота">заданными в радианах</a>, на входы
&laquo;<span class="rdsvar">Alpha</span>&raquo;, &laquo;<span class="rdsvar">Beta</span>&raquo; и &laquo;<span class="rdsvar">Gamma</span>&raquo; мы тоже будем
подавать значения в радианах. Если мы захотим задавать углы поворота
сегментов манипулятора в градусах, нам придется либо переключить единицу измерения углов в параметрах
систем координат, либо подключать к нашему блоку значения углов через стандартные библиотечные
блоки преобразования градусов в радианы. Будем считать, что мы выбрали второй путь
&ndash; &laquo;<span class="rdsvar">Alpha</span>&raquo;, &laquo;<span class="rdsvar">Beta</span>&raquo; и &laquo;<span class="rdsvar">Gamma</span>&raquo;
будут задаваться в радианах, а преобразования, если они потребуются, мы вынесем
за пределы создаваемого блока.</p>

<p>С учетом написанного выше, создадим в нашем блоке структуру переменных. Откроем окно
параметров блока двойным щелчком на нем или пунктом
&laquo;<span class="menu">параметры</span>&raquo; контекстного меню и выберем в нем вкладку
&laquo;<span class="menu">переменные</span>&raquo;
(<a href="#pic4" title="Вызов редактора переменных блока из окна параметров">рис.&nbsp;169</a>).
На этой вкладке видно, что у нашего блока уже есть
<a href="um_1_4.htm#light_ref24" title="Сигналы запуска и готовности блока">две стандартных сигнальных переменных</a>,
необходимых каждому простому блоку. Добавим к ним четыре новых, для чего нажмем
кнопку &laquo;<span class="menu">изменить</span>&raquo;.</p>

<div class="pic"><div class="container" id="pic4">
<img src="../img/PicEditExamp_3_1.png" width="534" height="250" alt="Вызов редактора переменных блока из окна параметров" />
<p id="light_pic4">Рис.&nbsp;169. Вызов редактора переменных блока из окна параметров</p>
</div></div>


<p>Нажатие кнопки &laquo;<span class="menu">изменить</span>&raquo; откроет
<a href="um_2_9_2.htm" title="&sect;2.9.2. Редактирование списка переменных блока">редактор переменных блока</a>, таблицу в
котором следует заполнить согласно
<a href="#pic5" title="Задание переменных в редакторе">рис.&nbsp;170</a>.
Стандартные сигнальные переменные &laquo;<span class="rdsvar">Start</span>&raquo; и &laquo;<span class="rdsvar">Ready</span>&raquo; мы
трогать не будем &ndash; хотя нашему блоку они и не нужны, удалить их нельзя.
Единственное, что можно, при желании, сделать &ndash; это убрать для них флажок в
колонке &laquo;<span class="menu">меню</span>&raquo;, чтобы они не появлялись в списках
<a href="um_2_9_2.htm#ref2" title="Разрешение входа/выхода в меню">основных входов и выходов</a>
при <a href="um_2_7_1.htm#pic2" title="Начало создания связи через контекстное меню (а) или при помощи щелчка мыши с нажатой клавишей Ctrl (б)">подключении связей к блоку</a>.</p>

<div class="pic"><div class="container" id="pic5">
<img src="../img/PicEditExamp_3_2.png" width="670" height="349" alt="Задание переменных в редакторе" />
<p id="light_pic5">Рис.&nbsp;170. Задание переменных в редакторе</p>
</div></div>


<p>После того, как редактор переменных заполнен, следует нажать кнопку
&laquo;<span class="menu">OK</span>&raquo; &ndash; окно редактора закроется, и на экране снова окажется
окно параметров блока, но на вкладке переменных будут теперь перечислены новые,
только что созданные, переменные.</p>

<p>Теперь можно перейти к редактированию картинки блока. Выберем в окне параметров
вкладку &laquo;<span class="menu">внешний вид</span>&raquo; (там по умолчанию уже установлен флажок
&laquo;<span class="menu">внешний вид &ndash; определяется картинкой</span>&raquo;) и нажмем в левой нижней
части вкладки кнопку &laquo;<span class="menu">изменить</span>&raquo;
(<a href="#pic6" title="Вызов редактора картинки">рис.&nbsp;171</a>).
Поверх окна параметров блока откроется окно редактора картинки с пустым рабочим полем.</p>

<div class="pic"><div class="container" id="pic6">
<img src="../img/PicEditExamp_4_1.png" width="534" height="463" alt="Вызов редактора картинки" />
<p id="light_pic6">Рис.&nbsp;171. Вызов редактора картинки</p>
</div></div>


<p>Нам предстоит совмещать оси поворота различных элементов, поэтому, если в
редакторе отключено изображение осей координат и центров, следует включить их
(<a href="#pic7" title="Окно редактора картинки (включено отображение осей и центров)">рис.&nbsp;172</a>,
см. также <a href="um_2_10_1.htm" title="&sect;2.10.1. Общие сведения о редакторе картинки">&sect;2.10.1</a>).</p>

<div class="pic"><div class="container" id="pic7">
<img src="../img/PicEditExamp_4_2.png" width="487" height="402" alt="Окно редактора картинки (включено отображение осей и центров)" />
<p id="light_pic7">Рис.&nbsp;172. Окно редактора картинки (включено отображение осей и центров)</p>
</div></div>


<div class="picright"><div class="container" id="pic8">
<img src="../img/PicEditExamp_5.png" width="255" height="201" alt="Основание манипулятора в редакторе картинки" />
<p id="light_pic8">Рис.&nbsp;173. Основание<br />манипулятора в редакторе<br />картинки</p>
</div></div>


<p>Сначала нарисуем неподвижное основание манипулятора. Создадим на рабочем поле
<a href="um_2_10_2.htm#light_ref9" title="Эллипс">эллипс</a>
размером 40&times;40 точек и разместим его так, чтобы его центр совпал с началом
координат картинки. Это можно сделать вручную, перетащив его мышью в нужное место,
или задав координаты его левого верхнего угла равными (&minus;20,&minus;20) &ndash;
тогда центр эллипса, представляющего собой окружность диаметром в 40 точек,
окажется в точке (0,0). Этот эллипс будет изображать шарнир крепления первого сегмента
к основанию. Теперь добавим на рабочее поле широкий прямоугольник, высотой больше
половины эллипса (например, размером 210&times;35 точек) и разместим его так, чтобы
он перекрывал нижнюю половину эллипса. Основание манипулятора готово
(<a href="#pic8" title="Основание манипулятора в редакторе картинки">рис.&nbsp;173</a>).</p>

<p>Если прямоугольник создан после эллипса, то с перекрытием не возникнет никаких
проблем &ndash; прямоугольник будет находиться ближе к переднему плану, и его
изображение перекроет собой эллипс. Если же отступить от приведенного выше
порядка создания фигур и сначала нарисовать прямоугольник, а затем
&ndash; эллипс, то эллипс будет перекрывать прямоугольник. В этом случае, чтобы
получить картинку, изображенную на <a href="#pic8" title="Основание манипулятора в редакторе картинки">рис.&nbsp;173</a>,
следует отправить эллипс на задний план, либо выбрав соответствующий пункт в его
контекстном меню, либо выделив его и нажав <span class="keys">Ctrl</span>&nbsp;+&nbsp;<span class="keys">PgDn</span>.</p>

<p>Теперь можно приступить к рисованию первого сегмента. Сегмент будет поворачиваться,
поэтому необходимо разместить его во вложенной системе координат. Создадим такую
систему: нажмем на панели элементов кнопку
&laquo;<span class="menu"><a href="um_2_10_8.htm#pic1" title="Создание вложенной системы координат: выбор режима и точки начала координат (а), новое окно редактора для созданной системы (б)">система координат</a></span>&raquo;
и щелкнем левой кнопкой мыши в точке пересечения осей координат рабочего поля
(можно не стараться точно попасть в эту точку &ndash; созданную систему координат можно
будет переместить потом). Поверх окна редактора картинки откроется новое,
с заголовком &laquo;система координат &ndash; уровень 1&raquo;, в нем мы и будем
рисовать первый сегмент манипулятора.</p>

<div style="clear:both;">
<div class="picright"><div class="container" id="pic9">
<img src="../img/PicEditExamp_6.png" width="255" height="281" alt="Первый сегмент манипулятора в редакторе картинки" />
<p id="light_pic9">Рис.&nbsp;174. Первый сегмент<br />манипулятора в редакторе<br />картинки</p>
</div></div>

</div>

<p>Создадим в окне редактора узкий высокий (например, размером 20&times;225 точек)
прямоугольник, изображающий сам сегмент, и разместим его так, чтобы вертикальная
ось координат проходила через его центр, а его нижняя сторона лежала на
горизонтальной оси
(<a href="#pic9" title="Первый сегмент манипулятора в редакторе картинки">рис.&nbsp;174</a>).
Поверх его верхней стороны нарисуем эллипс размером 40&times;40 точек, изображающий
шарнир второго сегмента. Вся эта конструкция будет поворачиваться вокруг своего
начала координат, поэтому так важно, чтобы точка пересечения осей координат,
то есть ось поворота, пришлась на середину нижней стороны сегмента. Позже мы свяжем
созданную вложенную систему координат с переменной блока &laquo;<span class="rdsvar">Alpha</span>&raquo;,
и нарисованные нами элементы будут поворачиваться против часовой стрелки при ее
положительных значениях и по часовой &ndash; при отрицательных. При нулевом значении
переменной конструкция будет находиться в том положении, в котором мы ее
нарисовали, то есть вертикально, как и задумано
(см. <a href="#pic1" title="Изображаемый манипулятор">рис.&nbsp;166</a>).</p>

<div style="clear:both;">
<div class="picright"><div class="container" id="pic10">
<img src="../img/PicEditExamp_7.png" width="277" height="78" alt="Второй сегмент манипулятора в редакторе картинки" />
<p id="light_pic10">Рис.&nbsp;175. Второй сегмент<br />манипулятора в редакторе<br />картинки</p>
</div></div>

</div>

<p>Нарисуем второй сегмент &ndash; добавим вложенную систему координат в центре
верхнего эллипса, то есть в точке крепления второго сегмента к шарниру.
Откроется новое окно редактора с заголовком
&laquo;система координат &ndash; уровень 2&raquo;. Нарисуем в нем конструкцию
из прямоугольника и эллипса, похожую на содержимое предыдущей системы координат,
но теперь расположим ее горизонтально &ndash; нулевой угол поворота второго
сегмента соответствует его горизонтальному положению. Начало координат системы
должно находиться в середине левой стороны прямоугольника &ndash; оно будет
осью поворота второго сегмента
(<a href="#pic10" title="Второй сегмент манипулятора в редакторе картинки">рис.&nbsp;175</a>).
Эллипс, изображающий шарнир, можно, при желании, не рисовать заново вручную &ndash;
точно такой же эллипс мы создали в предыдущей системе координат, поэтому, перед
созданием этой его можно скопировать в буфер обмена, нажав
<span class="keys">Ctrl</span>&nbsp;+&nbsp;<span class="keys">C</span>, а в этой системе вставить его оттуда, нажав
<span class="keys">Ctrl</span>&nbsp;+&nbsp;<span class="keys">V</span>.</p>

<div style="clear:both;">
<div class="picright"><div class="container" id="pic11">
<img src="../img/PicEditExamp_8.png" width="194" height="136" alt="Третий сегмент манипулятора в редакторе картинки (без губок)" />
<p id="light_pic11">Рис.&nbsp;176. Третий сегмент<br />манипулятора в редакторе<br />картинки (без губок)</p>
</div></div>

</div>

<p>Нарисуем третий сегмент &ndash; снова добавим вложенную систему координат в
центре эллипса шарнира (заголовком ее окна станет
&laquo;система координат &ndash; уровень 3&raquo;). Исходное направление
третьего сегмента &ndash; вертикально вниз, поэтому поместим в него узкий
вертикальный прямоугольник (например, размером 20&times;45 точек) так, чтобы
пересечение осей координат пришлось на середину его верхней стороны
(<a href="#pic11" title="Третий сегмент манипулятора в редакторе картинки (без губок)">рис.&nbsp;176</a>).
Прямо под ним нарисуем горизонтальный прямоугольник, по которому будут двигаться губки
захвата (размер прямоугольника на рисунке &ndash; 70&times;15 точек).</p>

<p>Теперь необходимо добавить к третьему сегменту подвижные губки. Двигать их
можно по-разному: можно, например, поместить каждую губку в отдельную систему
координат, связать горизонтальные координаты &laquo;<span class="rdsvar">X</span>&raquo; этих систем с
переменными блока и, изменяя значения этих переменных, двигать губки. Однако,
такой метод обладает двумя недостатками. Во-первых, для этого необходимы две
переменных, одна из которых будет увеличиваться, а другая в это же время &ndash;
уменьшаться (иначе губки будут не сдвигаться и раздвигаться, а вместе перемещаться
в одном и том же направлении). Во-вторых, перемещение губок придется задавать в
точках экрана, что не всегда удобно &ndash; при изменении картинки придется
корректировать коэффициенты пересчета относительного раскрытия захвата в
точки экрана. Ранее мы решили, что положение губок будет задаваться одной переменной
&laquo;<span class="rdsvar">C</span>&raquo;, нулевое значение которой соответствует полностью сдвинутым губкам,
единичное &ndash; полностью раздвинутым.
<span id="ref3">Здесь</span>
удобнее поступить <span id="light_ref3">следующим образом</span>:
каждую губку поместить в отдельную систему координат с запретом масштабирования
(назовем эти системы &laquo;<i>внутренними</i>&raquo;), а получившиеся две системы с
губками максимально раздвинуть и поместить внутрь еще одной системы (назовем ее
&laquo;<i>внешней</i>&raquo;), масштабный коэффициент которой связан с переменной
&laquo;<span class="rdsvar">C</span>&raquo;. Начала координат двух внутренних систем должны лежать на
горизонтальной оси внешней симметрично относительно ее вертикальной оси. При этом
будет происходить следующее:</p>

<ul>
  <li>При единичном значении &laquo;<span class="rdsvar">C</span>&raquo; содержимое внешней системы будет
  выглядеть как при редактировании, то есть губки будут находиться в максимально
  раздвинутом состоянии.</li>
  <li>При уменьшении &laquo;<span class="rdsvar">C</span>&raquo; координаты всех элементов внутри внешней
  системы, то есть координаты двух внутренних систем, будут умножаться на число,
  меньшее единицы. В результате начала координат внутренних систем начнут
  сближаться &ndash; они будут двигаться строго по горизонтали, поскольку
  вертикальные координаты обеих внутренних систем равны нулю и не будут изменяться,
  на какое бы число они ни умножались. При этом, поскольку масштабирование для
  внутренних систем запрещено, размеры губок не будут уменьшаться.</li>
  <li>Когда &laquo;<span class="rdsvar">C</span>&raquo; станет равной нулю, начала координат обеих внутренних
  систем встретятся в начале координат внешней &ndash; все координаты будут умножены
  на ноль и станут равны нулю. В результате губки захвата окажутся сдвинутыми до
  конца.</li>
</ul>

<p class="noindent">Таким образом, изменяя масштабный коэффициент внешней системы,
мы синхронно перемещаем обе губки захвата по горизонтали в разные стороны,
сохраняя их размер неизменным за счет запрета масштабирования внутренних систем.</p>

<p>Вместо того, чтобы, как раньше, создать новую вложенную систему координат и
наполнять ее содержимым, сначала нарисуем губки в той же системе координат, в
которой находится третий сегмент манипулятора
(см. <a href="#pic11" title="Третий сегмент манипулятора в редакторе картинки (без губок)">рис.&nbsp;176</a>),
а затем поместим их внутрь системы. Поскольку нам необходимо нарисовать губки
в полностью разведенном состоянии, удобнее видеть при этом горизонтальный
прямоугольник, по которому они будут перемещаться. Если же мы сначала создадим
новую систему, она откроется в новом окне, и мы не будем видеть элементов, которые
ее окружают.</p>

<div class="picright"><div class="container" id="pic12">
<img src="../img/PicEditExamp_9.png" width="311" height="237" alt="Левая губка захвата (масштаб увеличен)" />
<p id="light_pic12">Рис.&nbsp;177. Левая губка захвата<br />(масштаб увеличен)</p>
</div></div>


<p>Сначала добавим левую губку &ndash; нарисуем ее как
<a href="um_2_10_4.htm" title="&sect;2.10.4. Рисование многоугольников и ломаных линий">многоугольник</a>, левая верхняя точка которого
совпадает с левой нижней точкой горизонтального прямоугольника, по которому эта губка
будет двигаться вправо при закрытии захвата
(<a href="#pic12" title="Левая губка захвата (масштаб увеличен)">рис.&nbsp;177</a>).
Правую губку можно нарисовать вручную симметрично левой, либо, что гораздо удобнее,
продублировать левую, (выделив ее и нажав
<span class="keys">Ctrl</span>&nbsp;+&nbsp;<span class="keys">D</span> или скопировав ее в буфер обмена нажатием
<span class="keys">Ctrl</span>&nbsp;+&nbsp;<span class="keys">C</span>, а затем вставив копию нажатием
<span class="keys">Ctrl</span>&nbsp;+&nbsp;<span class="keys">V</span>), после чего отразить ее горизонтально, выбрав в контекстном
меню появившейся на рабочем поле копии пункт &laquo;<span class="menu">отразить/повернуть</span>&raquo;,
установив в
<a href="um_2_10_1.htm#pic3" title="Окно отражения элементов">открывшемся окне</a>
флажок &laquo;<span class="menu">горизонтально</span>&raquo; и нажав кнопку &laquo;<span class="menu">OK</span>&raquo;. Получившийся
после этого многоугольник следует переместить так, чтобы его крайняя правая точка
совпадала с правой нижней точкой горизонтального прямоугольника
(<a href="#pic13" title="Обе губки нарисованы">рис.&nbsp;178</a>).</p>

<div class="picright"><div class="container" id="pic13">
<img src="../img/PicEditExamp_10.png" width="194" height="136" alt="Обе губки нарисованы" />
<p id="light_pic13">Рис.&nbsp;178. Обе губки нарисованы</p>
</div></div>


<p>Теперь обе губки захвата нарисованы, но перемещаться они пока не способны:
нужно поместить их во вложенные системы координат &ndash; сначала по отдельности, а
затем &ndash; вместе, как было описано
<a href="#ref3" title="Способ управления перемещением">выше</a>). Выделим многоугольник левой губки,
щелкнув по нему левой кнопкой мыши, и выберем в главном меню редактора пункт
&laquo;<span class="menu">редактирование | поместить в систему</span>&raquo;. На выделенной губке появится
перекрестие в круге, отмечающее начало координат созданной системы. Оно находится
примерно посередине многоугольника, то есть не там, где нам нужно. Перетащим это
начало координат в правый верхний угол многоугольника
(<a href="#pic14" title="Перемещение начала координат левой губки (масштаб увеличен): исходное положение (а), перетаскивание перекрестия (б), новое положение начала координат (в)">рис.&nbsp;179</a>)
&ndash; теперь горизонтальная ось внутренней системы координат левой губки совпадает
с ее верхней стороной, а вертикальная – с правой. Осталось запретить ее
масштабирование, чтобы при изменении переменной &laquo;<span class="rdsvar">C</span>&raquo; губка не
меняла размер, а просто перемещалась. Для этого нужно нажать на изображении губки
правую кнопку мыши, выбрать в контекстном меню пункт &laquo;<span class="menu">параметры</span>&raquo;, в
открывшемся окне на вкладке &laquo;<span class="menu">параметры</span>&raquo; установить флажок
&laquo;<span class="menu">запретить масштабирование</span>&raquo;, а затем закрыть окно кнопкой
&laquo;<span class="menu">OK</span>&raquo;
(<a href="#pic15" title="Запрещение масштабирования системы координат левой губки захвата">рис.&nbsp;180</a>).</p>

<div class="pic"><div class="container" id="pic14">
<div class="multi" id="pic14_0"><img src="../img/PicEditExamp_11_1.png" width="311" height="237" alt="Перемещение начала координат левой губки (масштаб увеличен): исходное положение (а), перетаскивание перекрестия (б), новое положение начала координат (в) 1" /><p id="light_pic14_0">(а)</p></div><div class="multi" id="pic14_1"><img src="../img/PicEditExamp_11_2.png" width="311" height="237" alt="Перемещение начала координат левой губки (масштаб увеличен): исходное положение (а), перетаскивание перекрестия (б), новое положение начала координат (в) 2" /><p id="light_pic14_1">(б)</p></div><div class="multi" id="pic14_2"><img src="../img/PicEditExamp_11_3.png" width="311" height="237" alt="Перемещение начала координат левой губки (масштаб увеличен): исходное положение (а), перетаскивание перекрестия (б), новое положение начала координат (в) 3" /><p id="light_pic14_2">(в)</p></div><p id="light_pic14">Рис.&nbsp;179. Перемещение начала координат левой губки (масштаб увеличен): исходное положение (а), перетаскивание перекрестия (б), новое положение начала координат (в)</p>
</div></div>


<div class="pic"><div class="container" id="pic15">
<img src="../img/PicEditExamp_12.png" width="710" height="387" alt="Запрещение масштабирования системы координат левой губки захвата" />
<p id="light_pic15">Рис.&nbsp;180. Запрещение масштабирования системы координат левой губки захвата</p>
</div></div>


<div class="picright"><div class="container" id="pic16">
<img src="../img/PicEditExamp_14.png" width="194" height="137" alt="Губки помещены в системы координат" />
<p id="light_pic16">Рис.&nbsp;181. Губки помещены в системы координат</p>
</div></div>


<p>Теперь необходимо симметрично повторить описанные выше действия для правой губки:
выделить ее, поместить во вложенную систему координат, перетащить перекрестие начала
координат (на этот раз в левую верхнюю точку многоугольника) и запретить масштабирование
созданной системы. Если все сделано правильно, система координат третьего сегмента
манипулятора в данный момент должна выглядеть так, как на
<a href="#pic16" title="Губки помещены в системы координат">рис.&nbsp;181</a>
(на рисунке выделение со всех элементов снято, включено отображение осей координат и
центров).</p>

<p>Итак, изображения губок захвата помещены в отдельные системы координат, для которых
запрещено масштабирование. Теперь необходимо поместить обе эти системы внутрь еще одной,
масштабным коэффициентом которой будет управлять переменная &laquo;<span class="rdsvar">C</span>&raquo;.
Для этого необходимо выделить обе губки одновременно, как показано
на <a href="#pic17_0" title="Помещение губок в общую систему координат: выделенные по отдельности губки (а), после помещения в общую систему (б), перетаскивание начала координат (в), новое положение начала координат (г)">рис.&nbsp;182&nbsp;а</a>
(например, щелкнув левой кнопкой мыши по одной губке, а затем, нажав клавишу
<span class="keys">Shift</span>, щелкнув по другой), а затем выбрать в главном
меню редактора уже знакомый пункт &laquo;<span class="menu">редактирование | поместить в систему</span>&raquo;.
Начало координат новой созданной системы будет отмечено перекрестием с большим кругом,
начала координат двух ее внутренних вложенных систем &ndash; перекрестиями с маленькими
кругами (<a href="#pic17_1" title="Помещение губок в общую систему координат: выделенные по отдельности губки (а), после помещения в общую систему (б), перетаскивание начала координат (в), новое положение начала координат (г)">рис.&nbsp;182&nbsp;б</a>). </p>

<div class="pic"><div class="container" id="pic17">
<div class="multi" id="pic17_0"><img src="../img/PicEditExamp_15_1.png" width="190" height="153" alt="Помещение губок в общую систему координат: выделенные по отдельности губки (а), после помещения в общую систему (б), перетаскивание начала координат (в), новое положение начала координат (г) 1" /><p id="light_pic17_0">(а)</p></div><div class="multi" id="pic17_1"><img src="../img/PicEditExamp_15_2.png" width="190" height="153" alt="Помещение губок в общую систему координат: выделенные по отдельности губки (а), после помещения в общую систему (б), перетаскивание начала координат (в), новое положение начала координат (г) 2" /><p id="light_pic17_1">(б)</p></div><div class="multi" id="pic17_2"><img src="../img/PicEditExamp_15_3.png" width="190" height="153" alt="Помещение губок в общую систему координат: выделенные по отдельности губки (а), после помещения в общую систему (б), перетаскивание начала координат (в), новое положение начала координат (г) 3" /><p id="light_pic17_2">(в)</p></div><div class="multi" id="pic17_3"><img src="../img/PicEditExamp_15_4.png" width="190" height="153" alt="Помещение губок в общую систему координат: выделенные по отдельности губки (а), после помещения в общую систему (б), перетаскивание начала координат (в), новое положение начала координат (г) 4" /><p id="light_pic17_3">(г)</p></div><p id="light_pic17">Рис.&nbsp;182. Помещение губок в общую систему координат: выделенные по отдельности губки (а), после помещения в общую систему (б), перетаскивание начала координат (в), новое положение начала координат (г)</p>
</div></div>


<p>Теперь необходимо переместить начало координат внешней системы так, чтобы оно
находилось точно посередине между началами координат внутренних систем с губками
(<a href="#pic17_2" title="Помещение губок в общую систему координат: выделенные по отдельности губки (а), после помещения в общую систему (б), перетаскивание начала координат (в), новое положение начала координат (г)">рис.&nbsp;182&nbsp;в</a>), тогда изменение
масштаба внешней системы будет двигать губки строго по горизонтали. После того,
как это будет сделано, останется связать масштабный коэффициент этой системы с
переменной &laquo;<span class="rdsvar">C</span>&raquo;. Для этого следует вызвать контекстное меню системы
координат, щелкнув правой кнопкой мыши на изображении любого ее внутреннего элемента
(в данном случае &ndash; на изображении одной из губок или между ними, поскольку эта
область тоже попадает внутрь описывающего прямоугольника системы) и выбрать в нем пункт
&laquo;<span class="menu">параметры</span>&raquo;. В окне параметров на вкладке
&laquo;<span class="menu">связи</span>&raquo;
(<a href="#pic18" title="Связь масштабного коэффициента системы с переменной">рис.&nbsp;183</a>) на панели
&laquo;<span class="menu">масштаб</span>&raquo; переменную &laquo;<span class="rdsvar">C</span>&raquo; можно выбрать в выпадающем списке
или ввести ее имя вручную.</p>

<div class="pic"><div class="container" id="pic18">
<img src="../img/PicEditExamp_16.png" width="424" height="383" alt="Связь масштабного коэффициента системы с переменной" />
<p id="light_pic18">Рис.&nbsp;183. Связь масштабного коэффициента системы с переменной</p>
</div></div>


<p>Создание блока мы начали с задания списка переменных, поэтому сейчас, когда мы
редактируем картинку, переменные блока уже известны, и их можно выбирать в списках
в окнах параметров различных графических элементов. Если бы мы начали с
редактирования картинки, выпадающие списки были бы пусты, но имена переменных все
равно можно было бы вводить вручную с клавиатуры. Редактор картинки не требует,
чтобы переменная, связь с которой указывается в окне параметров элемента,
существовала. Если переменная с указанным именем отсутствует, элемент будет вести себя
так же, как и при отсутствии связи, а как только переменная появится в блоке,
связь будет установлена автоматически.</p>

<p>Теперь в системе координат третьего сегмента манипулятора есть работающий захват,
но сама эта система еще не связана с переменной &laquo;<span class="rdsvar">Gamma</span>&raquo;, которая
должна определять угол ее поворота. Чтобы установить эту связь, необходимо закрыть
окно редактора системы координат уровня 3 (обычной кнопкой закрытия окна Windows
или кнопкой <a href="um_2_10_1.htm#ref14" title="Кнопки панели функций">панели функций</a>
&laquo;<span class="menu">выйти из системы координат</span>&raquo;) и вернуться к редактированию системы уровня
2, то есть системы координат второго сегмента манипулятора. По сравнению
с <a href="#pic10" title="Второй сегмент манипулятора в редакторе картинки">рис.&nbsp;175</a>,
ее внешний вид изменился &ndash; теперь в ней присутствует система координат
третьего сегмента со всем своим содержимым
(<a href="#pic19" title="Содержимое системы координат второго сегмента манипулятора: сразу после редактирования третьего сегмента (а) и в окончательном виде (б)">рис.&nbsp;184</a>).
Если при создании системы третьего сегмента мы не очень точно попали курсором
мыши в центр эллипса шарнира, третий сегмент манипулятора будет смещен, как на
<a href="#pic19_0" title="Содержимое системы координат второго сегмента манипулятора: сразу после редактирования третьего сегмента (а) и в окончательном виде (б)">рис.&nbsp;184&nbsp;а</a>,
кроме того, третий сегмент находится ближе к переднему плану, чем этот эллипс,
поэтому верхняя часть прямоугольника третьего сегмента не скрыта под ним.</p>

<div class="pic"><div class="container" id="pic19">
<div class="multi" id="pic19_0"><img src="../img/PicEditExamp_17_1.png" width="318" height="142" alt="Содержимое системы координат второго сегмента манипулятора: сразу после редактирования третьего сегмента (а) и в окончательном виде (б) 1" /><p id="light_pic19_0">(а)</p></div><div class="multi" id="pic19_1"><img src="../img/PicEditExamp_17_2.png" width="318" height="142" alt="Содержимое системы координат второго сегмента манипулятора: сразу после редактирования третьего сегмента (а) и в окончательном виде (б) 2" /><p id="light_pic19_1">(б)</p></div><p id="light_pic19">Рис.&nbsp;184. Содержимое системы координат второго сегмента манипулятора: сразу<br />после редактирования третьего сегмента (а) и в окончательном виде (б)</p>
</div></div>


<p>Чтобы привести изображение в порядок, необходимо сделать две вещи: во-первых,
переместить третий сегмент так, чтобы его начало координат (перекрестие в большом круге)
совпало с центром эллипса шарнира, во-вторых, отправить эллипс на передний план
(выделив его и нажав <span class="keys">Ctrl</span>&nbsp;+&nbsp;<span class="keys">PgUp</span>). При перемещении третьего сегмента
мышью следует обратить внимание на то, за какую именно точку его перетаскивать.
Если попасть курсором мыши в большой круглый маркер выделения, вместо перемещения
всей системы координат будет перемещаться только ее начало (мы использовали это
при создании губок захвата, см.
<a href="#pic14" title="Перемещение начала координат левой губки (масштаб увеличен): исходное положение (а), перетаскивание перекрестия (б), новое положение начала координат (в)">рис.&nbsp;179</a>). Перетаскивать систему
координат вместе с ее содержимым следует за какую-либо свободную точку, на которой
нет маркеров. В нашем случае &ndash; за одну из губок или за один из двух
прямоугольников третьего сегмента. После выполнения всех указанных действий содержимое
системы координат второго уровня примет вид, изображенный на
<a href="#pic19_1" title="Содержимое системы координат второго сегмента манипулятора: сразу после редактирования третьего сегмента (а) и в окончательном виде (б)">рис.&nbsp;184&nbsp;б</a> &ndash; центр эллипса
шарнира совпадает с осью поворота третьего сегмента, концы сегментов скрыты под
эллипсом.</p>

<p>Теперь можно связать угол поворота системы координат третьего сегмента с
переменной &laquo;<span class="rdsvar">Gamma</span>&raquo;. Для этого следует выбрать в контекстном меню системы
координат пункт &laquo;<span class="menu">параметры</span>&raquo;, и в открывшемся окне на вкладке
&laquo;<span class="menu">связи</span>&raquo; выбрать эту переменную из выпадающего списка
(<a href="#pic20" title="Связь угла поворота системы с переменной">рис.&nbsp;185</a>).
В результате этого при изменении значения &laquo;<span class="rdsvar">Gamma</span>&raquo; третий сегмент
манипулятора будет поворачиваться вокруг оси, совпадающей с центром эллипса
шарнира, чего мы и добивались. Редактирование системы второго сегмента на этом
завершено &ndash; можно закрывать окно редактора и возвращаться к редактированию
первого сегмента.</p>

<div class="pic"><div class="container" id="pic20">
<img src="../img/PicEditExamp_18.png" width="424" height="383" alt="Связь угла поворота системы с переменной" />
<p id="light_pic20">Рис.&nbsp;185. Связь угла поворота системы с переменной</p>
</div></div>


<p>В системе координат первого сегмента теперь видны второй и третий,
однако, как и в предыдущем случае, второй сегмент расположен поверх эллипса шарнира и,
возможно, смещен в сторону
(<a href="#pic21_0" title="Содержимое системы координат первого сегмента манипулятора: сразу после редактирования второго сегмента (а) и в окончательном виде (б)">рис.&nbsp;186&nbsp;а</a>).
Необходимо совместить начало координат второго сегмента с центром эллипса и переместить
этот эллипс на передний план. Окончательный вид содержимого системы координат первого
сегмента изображен
на <a href="#pic21_1" title="Содержимое системы координат первого сегмента манипулятора: сразу после редактирования второго сегмента (а) и в окончательном виде (б)">рис.&nbsp;186&nbsp;б</a>.
Осталось только уже описанным выше способом связать угол поворота системы второго
сегмента с переменной &laquo;<span class="rdsvar">Beta</span>&raquo;, после чего окно системы первого сегмента
можно закрывать и возвращаться к редактору всей картинки.</p>

<div class="pic"><div class="container" id="pic21">
<div class="multi" id="pic21_0"><img src="../img/PicEditExamp_19_1.png" width="314" height="293" alt="Содержимое системы координат первого сегмента манипулятора: сразу после редактирования второго сегмента (а) и в окончательном виде (б) 1" /><p id="light_pic21_0">(а)</p></div><div class="multi" id="pic21_1"><img src="../img/PicEditExamp_19_2.png" width="314" height="293" alt="Содержимое системы координат первого сегмента манипулятора: сразу после редактирования второго сегмента (а) и в окончательном виде (б) 2" /><p id="light_pic21_1">(б)</p></div><p id="light_pic21">Рис.&nbsp;186. Содержимое системы координат первого сегмента манипулятора: сразу<br />после редактирования второго сегмента (а) и в окончательном виде (б)</p>
</div></div>


<p>В редакторе самой картинки (в заголовке его окна не будет слов
&laquo;система координат: уровень...&raquo;) необходимо выполнить похожие действия:
переместить систему координат первого сегмента (в ней находятся первый, второй и
третий сегменты вместе) так, чтобы ее начало совпало с центром эллипса шарнира,
связать угол ее поворота с переменной &laquo;<span class="rdsvar">Alpha</span>&raquo; и спрятать конец
первого сегмента под эллипсом. В данном случае нельзя отправлять эллипс на передний
план, поскольку он должен быть перекрыт прямоугольником неподвижного основания &ndash;
вместо этого можно отправить на задний план всю систему координат первого сегмента,
выделив ее и нажав <span class="keys">Ctrl</span>&nbsp;+&nbsp;<span class="keys">PgDn</span>. В результате всех действий готовая
картинка блока в окне редактора должна выглядеть так же, как
на <a href="#pic22" title="Готовая картинка блока в редакторе">рис.&nbsp;187</a>.
Окно редактора теперь можно закрывать &ndash; на экране снова появится окно параметров
блока с активной вкладкой
&laquo;<span class="menu"><a href="#pic6" title="Вызов редактора картинки">внешний вид</a></span>&raquo;,
только на панели просмотра картинки вместо слова &laquo;нет&raquo; появится
уменьшенное изображение нарисованного нами манипулятора. Окно параметров блока
необходимо закрыть кнопкой &laquo;<span class="menu">OK</span>&raquo;, в противном случае параметры блока
не будут изменены и созданная нами картинка будет потеряна.</p>

<div class="pic"><div class="container" id="pic22">
<img src="../img/PicEditExamp_20.png" width="491" height="422" alt="Готовая картинка блока в редакторе" />
<p id="light_pic22">Рис.&nbsp;187. Готовая картинка блока в редакторе</p>
</div></div>


<p>После нажатия &laquo;<span class="menu">OK</span>&raquo; в окне параметров блока внешний вид нашего
блока на рабочем поле подсистемы изменится &ndash; вместо небольшого белого квадрата
появится созданная нами картинка. Картинка получилась довольно большой, поэтому,
вероятнее всего, мы увидим только ее левую нижнюю часть, то есть область вблизи ее
начала координат. Необходимо перетащить блок мышью куда-нибудь в центр видимой части
рабочего поля (возможно, придется увеличить размер окна подсистемы, чтобы весь блок
был виден) и подключить к его входам
&laquo;<span class="rdsvar">Alpha</span>&raquo;, &laquo;<span class="rdsvar">Beta</span>&raquo;, &laquo;<span class="rdsvar">Gamma</span>&raquo; и
&laquo;<span class="rdsvar">C</span>&raquo; какие-нибудь органы управления: поля ввода, рукоятки и т.п.
Следует помнить, что при заданных нами параметрах связи с переменными картинка блока
будет воспринимать углы поворота в радианах (см. <a href="#pic20" title="Связь угла поворота системы с переменной">рис.&nbsp;185</a>),
поэтому, если мы хотим задавать углы поворота в градусах, необходимо либо подключать органы
управления к нашему блоку не напрямую, а через блоки перевода градусов в радианы (такой
стандартный блок находится на вкладке &laquo;алгебра&raquo;
<a href="um_2_1.htm#pic1" title="Главное окно RDS и его панели">панели блоков</a>, на его кнопке
написано &laquo;G/R&raquo;), либо изменить параметры систем координат картинки так,
чтобы значения переменных считались заданными в градусах.</p>

<p>На <a href="#pic23" title="Пример схемы для тестирования созданного блока">рис.&nbsp;188</a>
изображен пример схемы, с помощью которой можно проверить работу созданного нами
блока. В схему добавлено четыре поля ввода (с вкладки
&laquo;интерфейс&raquo; панели блоков), с заголовками
&laquo;&alpha;&raquo;, &laquo;&beta;&raquo;,
&laquo;&gamma;&raquo; и &laquo;Захват&raquo; (чтобы ввести греческие буквы в
заголовок поля ввода, необходимо в окне его параметров поменять шрифт заголовка,
например, на &laquo;Symbol&raquo;). Поле &laquo;Захват&raquo; непосредственно
соединено с входом &laquo;<span class="rdsvar">C</span>&raquo; нашего блока, а поля
&laquo;&alpha;&raquo;, &laquo;&beta;&raquo; и
&laquo;&gamma;&raquo; &ndash; с блоками перевода градусов в радианы, которые,
в свою очередь, соединены с входами
&laquo;<span class="rdsvar">Alpha</span>&raquo;, &laquo;<span class="rdsvar">Beta</span>&raquo; и &laquo;<span class="rdsvar">Gamma</span>&raquo; соответственно.
<a href="um_2_2.htm#light_ref8" title="Пример запуска расчета">Запустив расчет</a>
и меняя значения в полях ввода, можно заставить манипулятор двигаться
(<a href="#pic24" title="Управление манипулятором в режиме расчета">рис.&nbsp;189</a>).</p>

<div class="pic"><div class="container" id="pic23">
<img src="../img/PicEditExamp_21.png" width="866" height="486" alt="Пример схемы для тестирования созданного блока" />
<p id="light_pic23">Рис.&nbsp;188. Пример схемы для тестирования созданного блока</p>
</div></div>


<div class="pic"><div class="container" id="pic24">
<img src="../img/PicEditExamp_22.png" width="716" height="322" alt="Управление манипулятором в режиме расчета" />
<p id="light_pic24">Рис.&nbsp;189. Управление манипулятором в <a href="um_1_3.htm#ref3" title="Режим расчета">режиме расчета</a></p>
</div></div>


<p>Мы рассмотрели пример связи с переменными углов поворота и масштабных
коэффициентов частей картинки блока. Точно так же с переменными можно
связывать цвета, размеры, координаты, тексты и т п. &ndash; у каждого элемента
картинки есть свой индивидуальный набор параметров, которые могут быть связаны
с переменными блока.</p>

</div>
<p style="clear:both; min-height:1em; padding:0px; margin: 0px;"></p><hr class="off" /><div class="bottomnav">
<div class="left">
<span class="button"><a href="um_2_10_11.htm" title="Предыдущий параграф" id="pgup_f">&lt;&lt;</a></span>
<span class="button"><a href="um_2_11_1.htm" title="Следующий параграф" id="pgdn_f">&gt;&gt;</a></span>
<span class="divider"></span>
<span class="button"><a href="um_index.htm#light_htm:um_2_10_12">Оглавление</a></span>
<span class="button"><a href="alpha.htm">Указатель</a></span>
</div>
</div>
</body>
</html>
