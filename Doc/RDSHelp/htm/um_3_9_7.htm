<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru" xml:lang="ru">
<head>
  <link rel="stylesheet" type="text/css" href="../css/main.css" />
  <link rel="stylesheet" type="text/css" href="../css/cpp.css" />
  <meta http-equiv="Content-Type" content="text/html;charset=windows-1251" />
  <script type="text/javascript" src="script.js"></script>
  <title>&sect;3.9.7. Разбор ошибок компиляции</title>
</head><body onload="DocLoad()">
<div class="pageheader"><span class="off"><b>Текущий раздел:</b></span>
<div class="int"><p id="top"><a href="../index.htm">Описания RDS</a></p>
<div class="level"><p><a href="um_index.htm">Описание пользователя</a></p>
<div class="level"><p><a href="um_index.htm#light_htm:um_3">Глава 3. Использование стандартных модулей автокомпиляции</a></p>
<div class="level"><p><a href="um_index.htm#light_htm:um_3_9">&sect;3.9. Настройки стандартного модуля автокомпиляции</a></p>
<div class="level"><p>&sect;3.9.7. Разбор ошибок компиляции</p>
</div>
</div>
</div>
</div>
</div></div>
<div class="topnav"><span class="off"><b>Навигация:</b></span>
<div class="left">
<span class="button"><a href="um_3_9_6.htm" title="Предыдущий параграф" id="pgup">&lt;&lt;</a></span>
<span class="button"><a href="um_3_9_8.htm" title="Следующий параграф" id="pgdn">&gt;&gt;</a></span>
<span class="divider"></span>
<span class="button"><a href="um_index.htm#light_htm:um_3_9_7">Оглавление</a></span>
<span class="button"><a href="alpha.htm">Указатель</a></span>
</div>
</div>

<div class="text">
<h1 class="off">Описание пользователя</h1>
<h2 class="off">Глава 3. Использование стандартных модулей автокомпиляции</h2>
<h3 class="off">&sect;3.9. Настройки стандартного модуля автокомпиляции</h3>
<h4>&sect;3.9.7. Разбор ошибок компиляции</h4>
<p class="abstract">Описывается настройка автоматического разбора создаваемых компилятором отчетов для выделения из них сообщений об ошибках. Эти сообщения показываются пользователю непосредственно в окне редактора компилируемой модели.</p>


<p>Если в процессе компиляции модели в ее тексте обнаружены какие-либо ошибки, модуль автокомпиляции должен показать
список этих ошибок пользователю в окне редактора на специальной панели под вкладками с текстом реакций модели
на события (см. <a href="um_3_6_1.htm#pic1" title="Элементы окна редактора модели">рис.&nbsp;329</a>). При этом желательно,
чтобы двойной щелчок на ошибке в списке автоматически открывал вкладку с фрагментом исходного текста, в котором
она возникла, и устанавливал курсор в строку с ошибкой. Для этого модуль должен уметь разбирать отчеты, выдаваемые
компилятором и редактором связей.</p>

<p>Практически все компиляторы выдают текстовые отчеты о своей работе. Эти тексты имеют сложную структуру:
обычно они содержат имя и версию компилятора, имена обработанных файлов, обнаруженные ошибки, сводные данные о
результатах компиляции и т.п. В настройках модуля автокомпиляции задаются правила обработки таких текстов.
Необходимо указать, откуда модуль должен считывать эти тексты отчетов, как в них отмечены строки, содержащие
ошибки и предупреждения, где в этих строках находится номер строки исходного текста, а где &ndash; описание ошибки.
Поскольку редактор связей чаще всего является отдельной программой со своим форматом отчетов, правила разбора
текстов для него задаются отдельно. Настройка разбора отчетов &ndash; довольно сложная задача, поэтому, перед
тем, как приступать к ней, настоятельно рекомендуется изучить описание используемого компилятора и провести
несколько компиляций вручную, специально внося в текст программы различные ошибки и наблюдая, как они
отражаются в отчетах.</p>

<p>Для того, чтобы задать правила разбора отчета компилятора, следует
<a href="um_3_9_1.htm#light_ref1" title="Вызов настроек модуля автокомпиляции">вызвать окно настройки</a> модуля и на его вкладке
&laquo;<span class="menu">компилятор</span>&raquo; нажать кнопку &laquo;<span class="menu">дополнительно</span>&raquo;. В открывшемся дополнительном окне настроек
следует выбрать вкладку &laquo;<span class="menu">ошибки компилятора</span>&raquo;
(<a href="#pic1" title="Настройка разбора ошибок компилятора (на примере Borland C++ 5.5)">рис.&nbsp;496</a>).</p>

<div class="pic"><div class="container" id="pic1">
<img src="../img/AC_setup_aux_comperr.png" width="571" height="473" alt="Настройка разбора ошибок компилятора (на примере Borland C++ 5.5)" />
<p id="light_pic1">Рис.&nbsp;496. Настройка разбора ошибок компилятора (на примере Borland C++ 5.5)</p>
</div></div>


<p>Самый верхний флажок на вкладке, называющийся &laquo;<span class="menu">читать ошибки</span>&raquo;, разрешает обработку отчета
компилятора. Если его не установить, модуль автокомпиляции не будет обрабатывать отчет. Пользователь в этом
случае сможет узнать о том, что в его программе есть ошибки, только по сообщению о невозможности создать
DLL с моделью, которое модуль выдает самостоятельно, без анализа работы компилятора. Этого следует всячески
избегать, поскольку пользователю в этом случае будет очень сложно обнаружить ошибку. Нормально настроенный
модуль должен обрабатывать ошибки, и этот флажок должен быть установлен.</p>

<p>Справа от флажка находится выпадающий список, в котором нужно указать, куда именно компилятор выводит
отчет о своей работе. Следует выбрать один из трех вариантов: &laquo;из STDOUT&raquo;,
&laquo;из файла&raquo; или &laquo;из STDERR&raquo;. Большинство компиляторов &ndash; консольные
приложения Windows, а консольные приложения обычно работают с тремя стандартными потоками ввода-вывода:
потоком ввода данных &laquo;stdin&raquo;, потоком вывода данных &laquo;stdout&raquo; и потоком вывода
сообщений об ошибках &laquo;stderr&raquo;. Если компилятор выводят сообщения об ошибках в потоки
&laquo;stdout&raquo; или &laquo;stderr&raquo;, модуль автокомпиляции, запустивший компилятор, может
перед его запуском перенаправить эти потоки и получить из них данные, которые будут анализироваться.
В какой именно поток компилятор выводит сообщения об ошибках, следует узнать из его описания или
определить опытным путем, скомпилировав программу с ошибкой и перенаправив стандартные потоки вручную
(перенаправление вывода в командной строке производится при помощи символа &laquo;&gt;&raquo;, подробнее
об этом можно узнать в описании пользователя Windows). В выпадающем списке при этом следует выбрать
вариант &laquo;из STDOUT&raquo; или &laquo;из STDERR&raquo;, в зависимости от используемого компилятором
потока. Если же компилятор выводит отчет не в стандартный поток, а в отдельный файл, в выпадающем списке
следует выбрать вариант &laquo;из файла&raquo;, а в поле ввода справа от списка указать имя этого файла
(в имени можно использовать символические обозначения путей, рассмотренные
в <a href="um_3_9_4.htm" title="&sect;3.9.4. Символические имена параметров в настройках">&sect;3.9.4</a>).</p>

<p>Ниже находятся два поля ввода: &laquo;<span class="menu">не обрабатывать &ndash; начальных строк</span>&raquo; и
&laquo;<span class="menu">конечных строк</span>&raquo;, которые позволяют исключить из рассмотрения заданное число начальных
и конечных строк отчета компилятора. В начальных строках часто выводится название и версия компилятора,
а в конечных &ndash; сводные данные о результатах компиляции. К ошибкам эти строки не имеют прямого отношения,
поэтому их обрабатывать не нужно.</p>

<p>Далее расположен флажок &laquo;<span class="menu">считать все остальные строки ошибками</span>&raquo;. Его следует устанавливать
только в том случае, если сообщения об ошибках компилятора не имеют четкой формальной структуры и не могут
анализироваться способами, описанными ниже. В этом случае любая строка отчета, не входящая в число
пропускаемых начальных и конечных, будет показана пользователю как сообщение об ошибке без привязки к
какой-либо строке введенного им текста. Это очень неудобно, поскольку поиск ошибки в тексте в этом случае
ложится на пользователя, и установки этого флажка следует, по возможности, избегать.</p>

<p>Флажок &laquo;<span class="menu">пропускать строки, начинающиеся с пробелов</span>&raquo;, как следует из его названия, исключает
из рассмотрения строки отчета компилятора, которые начинаются с пробелов или знаков табуляции. В таких
строках обычно содержится различная дополнительная информация, которую можно не анализировать.</p>

<p>Ниже расположены три похожих флажка, управляющие выделением из отчета интересующих модуль строк:
&laquo;<span class="menu">искать ошибку по слову</span>&raquo;, &laquo;<span class="menu">искать предупреждение по слову</span>&raquo; и
&laquo;<span class="menu">пропускать строки по слову</span>&raquo;. После каждого из этих флажков находится поле ввода, в
котором указывается искомое слово, и дополнительный флажок, требующий нахождения этого слова в начале строки
отчета. Кроме того, под этими флажками находится флажок &laquo;<span class="menu">искать с учетом регистра</span>&raquo;, управляющий
поиском слова в строке.</p>

<p>Если установлен флажок &laquo;<span class="menu">искать ошибку по слову</span>&raquo;, сообщениями об ошибках будут считаться только
строки отчета, содержащие указанное после флажка слово (с учетом или без учета регистра символов,
определяется флажком &laquo;<span class="menu">искать с учетом регистра</span>&raquo;). При этом, если установлен дополнительный флажок
&laquo;<span class="menu">в начале строки</span>&raquo;, строки, в которых найденное слово не находится в начале строки отчета,
будут исключены из рассмотрения. Точно так же работает флажок &laquo;<span class="menu">искать предупреждение по слову</span>&raquo;.
Флажок &laquo;<span class="menu">пропускать строки по слову</span>&raquo; исключает их рассмотрения строки, содержащие заданное слово,
даже если они содержат слова, указанные в качестве слов-признаков ошибок и предупреждений (так можно пропускать
диагностические сообщения компилятора). Настройки, приведенные в качестве примера
на <a href="#pic1" title="Настройка разбора ошибок компилятора (на примере Borland C++ 5.5)">рис.&nbsp;496</a>, указывают модулю считать сообщениями об
ошибках любые строки, начинающиеся со слова &laquo;error&raquo; в любом регистре (то есть подойдут и
&laquo;ERROR&raquo;, и &laquo;Error&raquo;), а предупреждениями &ndash; строки, начинающиеся со слова
&laquo;warning&raquo;. Пропуск строк по слову в этих настройках отключен.</p>

<p>Установка флажка &laquo;<span class="menu">игнорировать неопознанные строки</span>&raquo; исключает из рассмотрения строки отчета, в
которых не оказалось ни слова, отмечающего сообщение об ошибке, ни слова, отмечающего предупреждение. Без
установки одного из флажков поиска, описанных выше, установка этого флажка не рекомендуется, поскольку это заставит
модуль игнорировать все строки отчета, так как все они окажутся неопознанными.</p>

<p>Далее располагаются два поля ввода, управляющие анализом опознанных строк отчета, то есть строк, в которых
обнаружено либо слово, отмечающее ошибку, либо слово, отмечающее предупреждение (для этого хотя бы один из флажков
&laquo;<span class="menu">искать ошибку по слову</span>&raquo; и &laquo;<span class="menu">искать предупреждение по слову</span>&raquo; должен быть установлен).
В поле ввода &laquo;<span class="menu">формат строки</span>&raquo; через пробел указываются условные обозначения, отмечающие
последовательность слов в сообщениях об ошибке и предупреждениях. Можно использовать следующие обозначения:</p>

<ul>
  <li>&laquo;FILE&raquo; &ndash; имя файла исходного текста;</li>
  <li>&laquo;LINE&raquo; &ndash; номер строки исходного текста;</li>
  <li>&laquo;CODE&raquo; &ndash; код ошибки;</li>
  <li>&laquo;MARK&raquo; &ndash; пропустить все слова до обнаруженного слова-маркера ошибки или предупреждения
  (то есть одного из слов, указанных после флажков &laquo;<span class="menu">искать ошибку по слову</span>&raquo; и &laquo;<span class="menu">
  искать предупреждение по слову</span>&raquo;) включительно;</li>
  <li>&laquo;SKIP&raquo; &ndash; пропуск одного слова.</li>
</ul>

<p class="noindent">Эти обозначения можно как вводить вручную с клавиатуры, так и выбирать из меню, открываемого кнопкой с
многоточием рядом с полем.</p>

<p>Справа от поля &laquo;<span class="menu">формат строки</span>&raquo;, в поле &laquo;<span class="menu">разделители</span>&raquo;, подряд вводятся символы,
которые в строке отчета должны считаться разделителями слов. Пробел и символ табуляции всегда считаются
разделителями, и их не нужно указывать отдельно. Строка отчета, опознанная как сообщение об ошибке или
предупреждение, разбивается на слова согласно указанному списку разделителей, а затем ее начало разбирается согласно
обозначениям из поля &laquo;<span class="menu">формат строки</span>&raquo;: оттуда извлекается код ошибки, номер строки и т.п.
Не разобранный конец строки считается описанием ошибки и показывается пользователю.</p>

<p>На <a href="#pic1" title="Настройка разбора ошибок компилятора (на примере Borland C++ 5.5)">рис.&nbsp;496</a> формат строки указан в виде
&laquo;SKIP CODE FILE LINE&raquo;, а в качестве разделителя указан символ двоеточия. Проиллюстрируем разбор
сообщения об ошибке на примере следующего отчета компилятора Borland C++ 5.5:</p>

<pre class="cpp">  src_p2_4.cpp:
  Error E2303 src_p2_4.cpp 20: Type name expected
  *** 1 errors in Compile ***</pre>

<p>Согласно настройкам на рисунке, в этом тексте только вторая строка будет опознана модулем как сообщение об ошибке:
в ее начале содержится слово &laquo;error&raquo;. Таким образом, только она будет разобрана по формату
&laquo;SKIP CODE FILE LINE&raquo;. Разбор будет выглядеть следующим образом:</p>

<div class="tablecenter"><div class="tcont">
<table>
  <tr>
    <td class="center">SKIP</td>
    <td class="center">CODE</td>
    <td class="center">FILE</td>
    <td class="center">LINE</td>
    <td></td>
    <td class="center">остаток строки</td>
  </tr>
  <tr>
    <td><span class="cpp">Error</span></td>
    <td><span class="cpp">E2303</span></td>
    <td><span class="cpp">src_p2_4.cpp</span></td>
    <td><span class="cpp">20</span></td>
    <td><span class="cpp">:</span></td>
    <td><span class="cpp">Type name expected</span></td>
  </tr>
  <tr>
    <td class="center">пропуск</td>
    <td class="center">код ошибки</td>
    <td class="center">имя файла</td>
    <td class="center">номер строки</td>
    <td class="center">разделитель</td>
    <td class="center">текст описания ошибки</td>
  </tr>
</table>
</div></div>

<p>Ошибка опознана как ошибка &laquo;type name expected&raquo; (&laquo;требуется имя типа&raquo;) с кодом
E2303 в строке номер 20. На данный момент извлеченные из строки код ошибки и имя файла никак не используются
модулем автокомпиляции, используется только номер строки и текст описания. В окне редактора пользователь увидит
сообщение об этой ошибке в следующем виде:</p>

<pre class="cpp">  [Ошибка С++] Описания (2): Type name expected</pre>

<p>Здесь &laquo;описания&raquo; &ndash; название фрагмента введенного пользователем фрагмента текста модели, а
2 &ndash; номер строки в этом тексте. Модуль автоматически находит фрагмент текста по номеру строки из
сообщения об ошибке и выводит в сообщении номер строки не во всем автоматически сформированном тексте программы,
который обработал компилятор, а внутри этого найденного фрагмента. При двойном щелчке на этом сообщении
автоматически откроется вкладка глобальных описаний модели
(см. <a href="um_3_8_1.htm" title="&sect;3.8.1. Дополнительные описания, вводимые в модель">&sect;3.8.1</a>) и курсор будет установлен на вторую строку этой вкладки,
то есть на ту строку, в которой компилятор нашел ошибку.</p>

<p>В нижней части вкладки находится кнопка &laquo;<span class="menu">восстановить исходные</span>&raquo;, заполняющая вкладку параметрами,
которые разработчики модуля считают подходящими для компилятора, для которого предназначен настраиваемый
модуль. При настройке универсальных модулей использовать эту кнопку не имеет смысла.</p>

<p>Чаще всего редактор связей для преобразования скомпилированного объектного файла в DLL вызывается как
отдельная программа (см. <a href="um_3_9_6.htm" title="&sect;3.9.6. Запуск компилятора и редактора связей">&sect;3.9.6</a>). Однако, некоторые компиляторы способны
сами вызывать редактор связей, и, в этом случае, у компилятора и редактора связей будет один общий отчет.
Если редактор связей запускается самим компилятором, то есть если на вкладке
&laquo;<span class="menu">редактор связей</span>&raquo; не установлен флажок
&laquo;<span class="menu">вызывать редактор связей после компилятора</span>&raquo;
(см. <a href="um_3_9_6.htm#pic2" title="Настройка запуска редактора связей (на примере Borland C++ 5.5)">рис.&nbsp;494</a>), на вкладке
&laquo;<span class="menu">ошибки компилятора</span>&raquo; под горизонтальной чертой будет активна группа флажков, задающая разбиение
общего отчета на отчет компилятора и отчет редактора связей
(<a href="#pic2" title="Настройка выделения отчета редактора связей">рис.&nbsp;497</a>).</p>

<div class="pic"><div class="container" id="pic2">
<img src="../img/AC_setup_aux_comperr_link.png" width="560" height="79" alt="Настройка выделения отчета редактора связей" />
<p id="light_pic2">Рис.&nbsp;497. Настройка выделения отчета редактора связей</p>
</div></div>


<p>Общий отчет всегда начинается с отчета компилятора. Отчет редактора связей обычно начинается с какого-то
текста &ndash; например, с имени редактора связей. Этот текст можно указать в поле ввода после флажка
&laquo;<span class="menu">отчет редактора связей начинается после слова</span>&raquo;. При этом флажок &laquo;<span class="menu">в начале строки</span>&raquo;
будет требовать того, чтобы этот текст находился в начале строки отчета (обычно так и бывает), а флажок
&laquo;<span class="menu">с учетом регистра</span>&raquo; будет требовать совпадения регистра всех символов найденного текста
с введенным образцом. Как только строка с указанным текстом будет найдена, все строки после нее будут
считаться отчетом редактора связей и обрабатываться по другим правилам.</p>

<p>Правила обработки отчета редактора связей (не важно, вызывается он отдельно или запускается автоматически самим
компилятором) задаются на вкладке &laquo;<span class="menu">ошибки редактора связей</span>&raquo; того же окна дополнительных настроек
модуля (<a href="#pic3" title="Настройка разбора ошибок редактора связей">рис.&nbsp;498</a>).</p>

<div class="pic"><div class="container" id="pic3">
<img src="../img/AC_setup_aux_linkerr.png" width="571" height="473" alt="Настройка разбора ошибок редактора связей" />
<p id="light_pic3">Рис.&nbsp;498. Настройка разбора ошибок редактора связей</p>
</div></div>


<p>Поля этой вкладки совпадают с полями вкладки разбора ошибок компилятора
(см. <a href="#pic1" title="Настройка разбора ошибок компилятора (на примере Borland C++ 5.5)">рис.&nbsp;496</a>) и разбор отчета производится по
таким же правилам. Следует учитывать, что редактор связи работает не с исходным текстом программы, а с
уже скомпилированным объектным файлом, поэтому в его сообщениях об ошибках номера строк, как правило,
отсутствуют. Редактор связей может, например, определить, что какая-то функция описана в программе, но
тело ее отсутствует &ndash; у такой ошибки в принципе не может быть номера строки. По этой причине ошибки
редактора связей, чаще всего, не разбираются и показываются пользователю &laquo;как есть&raquo;. Кроме
того, если файл не скомпилирован из-за ошибок, редактор связей тоже выдаст ошибку из-за отсутствия
объектного файла, который он должен обработать. Такие вторичные ошибки сами исчезают после исправления
ошибок, о которых сообщил компилятор.</p>

<p>Ранее был приведен пример отчета компилятора с ошибкой &laquo;type name expected&raquo;
(&laquo;требуется имя типа&raquo;) &ndash; такая ошибка делает невозможным компиляцию и, таким образом,
создание объектного файла. В результате пользователь, допустивший ее, увидит сразу три сообщения об ошибках:</p>

<pre class="cpp">  [Ошибка С++] Описания (2): Type name expected
  [Ошибка ilink32]: Fatal: Unable to open file 'src_p2_4.obj'
  [Анализ]: Файл DLL не создан</pre>

<p>Первая строка в этом списке &ndash; обнаруженная и разобранная ошибка компилятора, уже рассмотренная выше.
Вторая строка &ndash; обнаруженная ошибка редактора связей, который не смог открыть объектный файл, не
созданный компилятором из-за первой ошибки. Третья строка &ndash; сообщение самого модуля о том, что, по
каким-то причинам, в результате компиляции не был создан файл DLL с моделью блока. Это третье сообщение не
связано с разбором отчетов компилятора и редактора связей, модуль выводит его автоматически. Если отключить
в параметрах модуля анализ отчетов, это сообщение будет единственным, которое увидит пользователь.</p>

<p><span id="ref1">Если</span>
в параметрах модуля автокомпиляции задан запуск дополнительной программы после редактора связей
(см. <a href="um_3_9_6.htm#pic3" title="Настройка запуска дополнительной программы">рис.&nbsp;495</a>), модуль может также
<span id="light_ref1">разобрать отчет о
работе, формируемый этой программой</span>. Правила его разбора задаются на вкладке
&laquo;<span class="menu">ошибки доп.программы</span>&raquo; того же окна дополнительных настроек модуля. Все поля этой вкладки
совпадают с полями вкладки разбора отчета редактора связей
(см. <a href="#pic3" title="Настройка разбора ошибок редактора связей">рис.&nbsp;498</a>) и имеют тот же смысл, поэтому она
здесь не описывается.</p>

<p>В процессе настройки модуля на разбор отчетов нестандартного компилятора большую помощь может
оказать функция показа отчета компилятора, которую можно вызвать пунктом меню
&laquo;<span class="menu">модель | показать отчет компилятора</span>&raquo; из окна редактора модели. Если запуск компилятора и
редактора связей уже настроен, эта функция покажет на отдельной вкладке командные строки и параметры запуска
этих программ, а также полные тексты сформированных ими отчетов.</p>


</div>
<p style="clear:both; min-height:1em; padding:0px; margin: 0px;"></p><hr class="off" /><div class="bottomnav">
<div class="left">
<span class="button"><a href="um_3_9_6.htm" title="Предыдущий параграф" id="pgup_f">&lt;&lt;</a></span>
<span class="button"><a href="um_3_9_8.htm" title="Следующий параграф" id="pgdn_f">&gt;&gt;</a></span>
<span class="divider"></span>
<span class="button"><a href="um_index.htm#light_htm:um_3_9_7">Оглавление</a></span>
<span class="button"><a href="alpha.htm">Указатель</a></span>
</div>
</div>
</body>
</html>
